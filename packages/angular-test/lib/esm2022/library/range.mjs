import { TestBed } from '@angular/core/testing';
import { By } from '@angular/platform-browser';
import { baseSetup, setupMockStore, getJsonFormsService, } from './util';
import { Actions } from '@jsonforms/core';
const prepareComponent = (testConfig, instance) => {
    const fixture = TestBed.createComponent(testConfig.componentUT);
    const component = fixture.componentInstance;
    const rangeElement = fixture.debugElement.query(By.directive(instance));
    const thumbElement = fixture.debugElement.query(By.css('[matsliderthumb]')); //rangeElement.nativeElement.children[0]; // todo: find a safer way to get the 'matSliderThumb'
    const result = {
        fixture,
        component,
        rangeElement,
        thumbElement,
    };
    return result;
};
export const rangeDefaultData = { foo: 1.234 };
export const rangeDefaultSchema = {
    type: 'object',
    properties: {
        foo: {
            type: 'number',
            minimum: -42.42,
            maximum: 42.42,
            default: 0.42,
        },
    },
};
export const rangeDefaultUischema = {
    type: 'Control',
    scope: '#/properties/foo',
    options: { slider: true },
};
export const rangeDefaultTestData = {
    data: rangeDefaultData,
    schema: rangeDefaultSchema,
    uischema: rangeDefaultUischema,
};
export const rangeBaseTest = (testConfig, instance) => () => {
    let fixture;
    let rangeElement;
    let thumbElement;
    let component;
    baseSetup(testConfig);
    beforeEach(() => {
        const preparedComponents = prepareComponent(testConfig, instance);
        fixture = preparedComponents.fixture;
        rangeElement = preparedComponents.rangeElement;
        thumbElement = preparedComponents.thumbElement;
        component = preparedComponents.component;
    });
    it('should render floats', () => {
        component.uischema = rangeDefaultTestData.uischema;
        component.schema = rangeDefaultTestData.schema;
        getJsonFormsService(component).init({
            core: {
                data: rangeDefaultTestData.data,
                schema: rangeDefaultTestData.schema,
                uischema: rangeDefaultTestData.uischema,
            },
        });
        component.ngOnInit();
        fixture.detectChanges();
        expect(component.data).toBe(1.234);
        expect(thumbElement.componentInstance.data).toBe(1.234);
        // step is of type string
        expect(rangeElement.componentInstance.step).toBe(1);
        expect(rangeElement.componentInstance.min).toBe(-42.42);
        expect(rangeElement.componentInstance.max).toBe(42.42);
        expect(rangeElement.componentInstance.disabled).toBe(false);
        expect(fixture.nativeElement.children[0].style.display).not.toBe('none');
    });
    it('should render integer', () => {
        component.uischema = rangeDefaultTestData.uischema;
        const schema = JSON.parse(JSON.stringify(rangeDefaultTestData.schema));
        schema.properties.foo.type = 'integer';
        schema.properties.foo.minimum = -42;
        schema.properties.foo.maximum = 42;
        schema.properties.foo.default = 1;
        setupMockStore(fixture, {
            uischema: rangeDefaultTestData.uischema,
            schema,
            data: { foo: 12 },
        });
        getJsonFormsService(component).updateCore(Actions.init({ foo: 12 }, schema, rangeDefaultTestData.uischema));
        fixture.componentInstance.ngOnInit();
        fixture.detectChanges();
        expect(component.data).toBe(12);
        expect(thumbElement.componentInstance.data).toBe(12);
        // step is of type string
        expect(rangeElement.componentInstance.step).toBe(1);
        expect(rangeElement.componentInstance.min).toBe(-42);
        expect(rangeElement.componentInstance.max).toBe(42);
        expect(rangeElement.componentInstance.disabled).toBe(false);
        // the component is wrapped in a div
        expect(fixture.nativeElement.children[0].style.display).not.toBe('none');
    });
    it('should support updating the state', () => {
        component.uischema = rangeDefaultTestData.uischema;
        component.schema = rangeDefaultTestData.schema;
        getJsonFormsService(component).init({
            core: {
                data: rangeDefaultTestData.data,
                schema: rangeDefaultTestData.schema,
                uischema: rangeDefaultTestData.uischema,
            },
        });
        component.ngOnInit();
        fixture.detectChanges();
        getJsonFormsService(component).updateCore(Actions.update('foo', () => 4.56));
        fixture.detectChanges();
        expect(component.data).toBe(4.56);
        expect(thumbElement.componentInstance.data).toBe(4.56);
    });
    it('should update with undefined value', () => {
        component.uischema = rangeDefaultTestData.uischema;
        component.schema = rangeDefaultTestData.schema;
        getJsonFormsService(component).init({
            core: {
                data: rangeDefaultTestData.data,
                schema: rangeDefaultTestData.schema,
                uischema: rangeDefaultTestData.uischema,
            },
        });
        component.ngOnInit();
        fixture.detectChanges();
        getJsonFormsService(component).updateCore(Actions.update('foo', () => undefined));
        fixture.detectChanges();
        expect(component.data).toBe(undefined);
        expect(thumbElement.componentInstance.data).toBe(undefined);
    });
    it('should update with null value', () => {
        component.uischema = rangeDefaultTestData.uischema;
        component.schema = rangeDefaultTestData.schema;
        getJsonFormsService(component).init({
            core: {
                data: rangeDefaultTestData.data,
                schema: rangeDefaultTestData.schema,
                uischema: rangeDefaultTestData.uischema,
            },
        });
        component.ngOnInit();
        fixture.detectChanges();
        getJsonFormsService(component).updateCore(Actions.update('foo', () => null));
        fixture.detectChanges();
        expect(component.data).toBe(null);
        expect(thumbElement.componentInstance.data).toBe(null);
    });
    it('should not update with wrong ref', () => {
        component.uischema = rangeDefaultTestData.uischema;
        component.schema = rangeDefaultTestData.schema;
        getJsonFormsService(component).init({
            core: {
                data: rangeDefaultTestData.data,
                schema: rangeDefaultTestData.schema,
                uischema: rangeDefaultTestData.uischema,
            },
        });
        component.ngOnInit();
        fixture.detectChanges();
        getJsonFormsService(component).updateCore(Actions.update('foo', () => 1.234));
        getJsonFormsService(component).updateCore(Actions.update('bar', () => 456.456));
        fixture.detectChanges();
        expect(component.data).toBe(1.234);
        expect(thumbElement.componentInstance.data).toBe(1.234);
    });
    // store needed as we evaluate the calculated enabled value to disable/enable the control
    it('can be disabled', () => {
        component.uischema = rangeDefaultTestData.uischema;
        component.schema = rangeDefaultTestData.schema;
        component.disabled = true;
        getJsonFormsService(component).init({
            core: {
                data: rangeDefaultTestData.data,
                schema: rangeDefaultTestData.schema,
                uischema: rangeDefaultTestData.uischema,
            },
        });
        component.ngOnInit();
        fixture.detectChanges();
        expect(rangeElement.componentInstance.disabled).toBe(true);
    });
    it('can be hidden', () => {
        component.uischema = rangeDefaultTestData.uischema;
        component.schema = rangeDefaultTestData.schema;
        component.visible = false;
        getJsonFormsService(component).init({
            core: {
                data: rangeDefaultTestData.data,
                schema: rangeDefaultTestData.schema,
                uischema: rangeDefaultTestData.uischema,
            },
        });
        fixture.detectChanges();
        component.ngOnInit();
        expect(fixture.nativeElement.children[0].style.display).toBe('none');
    });
    it('id should be present in output', () => {
        component.uischema = rangeDefaultTestData.uischema;
        component.schema = rangeDefaultTestData.schema;
        component.id = 'myId';
        getJsonFormsService(component).init({
            core: {
                data: rangeDefaultTestData.data,
                schema: rangeDefaultTestData.schema,
                uischema: rangeDefaultTestData.uischema,
            },
        });
        component.ngOnInit();
        fixture.detectChanges();
        expect(rangeElement.nativeElement.id).toBe('myId');
    });
};
export const rangeInputEventTest = (testConfig, instance) => () => {
    let fixture;
    let component;
    baseSetup(testConfig);
    beforeEach(() => {
        const preparedComponents = prepareComponent(testConfig, instance);
        fixture = preparedComponents.fixture;
        component = preparedComponents.component;
    });
    xit('should update via input event', async () => {
        component.uischema = rangeDefaultTestData.uischema;
        component.schema = rangeDefaultTestData.schema;
        getJsonFormsService(component).init({
            core: {
                data: rangeDefaultTestData.data,
                schema: rangeDefaultTestData.schema,
                uischema: rangeDefaultTestData.uischema,
            },
        });
        component.ngOnInit();
        fixture.detectChanges();
        const spy = spyOn(component, 'onChange');
        const sliderElement = fixture.debugElement.query(By.css('.mat-slider')).nativeElement;
        const trackElement = fixture.debugElement.query(By.css('.mat-slider-wrapper')).nativeElement;
        const dimensions = trackElement.getBoundingClientRect();
        const x = dimensions.left + dimensions.width * 0.2;
        const y = dimensions.top + dimensions.height * 0.2;
        dispatchEvent(sliderElement, createMouseEvent('mousedown', x, y, 0));
        // trigger change detection
        fixture.detectChanges();
        await fixture.whenStable();
        expect(spy).toHaveBeenCalled();
    });
};
export const rangeErrorTest = (testConfig, instance, errorTestInformation) => () => {
    let fixture;
    let component;
    baseSetup(testConfig);
    beforeEach(() => {
        const preparedComponents = prepareComponent(testConfig, instance);
        fixture = preparedComponents.fixture;
        component = preparedComponents.component;
    });
    it('should display errors', () => {
        component.uischema = rangeDefaultTestData.uischema;
        component.schema = rangeDefaultTestData.schema;
        const formsService = getJsonFormsService(component);
        formsService.init({
            core: {
                data: rangeDefaultTestData.data,
                schema: rangeDefaultTestData.schema,
                uischema: undefined,
            },
        });
        formsService.updateCore(Actions.updateErrors([
            {
                instancePath: '/foo',
                message: 'Hi, this is me, test error!',
                keyword: '',
                schemaPath: '',
                params: {},
            },
        ]));
        formsService.refresh();
        component.ngOnInit();
        fixture.detectChanges();
        const debugErrors = fixture.debugElement.queryAll(By.directive(errorTestInformation.errorInstance));
        expect(debugErrors.length).toBe(errorTestInformation.numberOfElements);
        expect(debugErrors[errorTestInformation.indexOfElement].nativeElement
            .textContent).toBe('Hi, this is me, test error!');
    });
};
/** Creates a browser MouseEvent with the specified options. */
const createMouseEvent = (type, x = 0, y = 0, button = 0) => {
    const event = document.createEvent('MouseEvent');
    event.initMouseEvent(type, true /* canBubble */, false /* cancelable */, window /* view */, 0 /* detail */, x /* screenX */, y /* screenY */, x /* clientX */, y /* clientY */, false /* ctrlKey */, false /* altKey */, false /* shiftKey */, false /* metaKey */, button /* button */, null /* relatedTarget */);
    // `initMouseEvent` doesn't allow us to pass the `buttons` and
    // defaults it to 0 which looks like a fake event.
    Object.defineProperty(event, 'buttons', { get: () => 1 });
    return event;
};
/** Utility to dispatch any event on a Node. */
const dispatchEvent = (node, event) => {
    node.dispatchEvent(event);
    return event;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmFuZ2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvbGlicmFyeS9yYW5nZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUF5QkEsT0FBTyxFQUFvQixPQUFPLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUNsRSxPQUFPLEVBQUUsRUFBRSxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFHL0MsT0FBTyxFQUNMLFNBQVMsRUFFVCxjQUFjLEVBR2QsbUJBQW1CLEdBQ3BCLE1BQU0sUUFBUSxDQUFDO0FBQ2hCLE9BQU8sRUFBOEIsT0FBTyxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFTdEUsTUFBTSxnQkFBZ0IsR0FBRyxDQUN2QixVQUF5QixFQUN6QixRQUFpQixFQUNHLEVBQUU7SUFDdEIsTUFBTSxPQUFPLEdBQUcsT0FBTyxDQUFDLGVBQWUsQ0FBQyxVQUFVLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDaEUsTUFBTSxTQUFTLEdBQUcsT0FBTyxDQUFDLGlCQUFpQixDQUFDO0lBQzVDLE1BQU0sWUFBWSxHQUFHLE9BQU8sQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztJQUN4RSxNQUFNLFlBQVksR0FBRyxPQUFPLENBQUMsWUFBWSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLGtCQUFrQixDQUFDLENBQUMsQ0FBQyxDQUFDLCtGQUErRjtJQUM1SyxNQUFNLE1BQU0sR0FBdUI7UUFDakMsT0FBTztRQUNQLFNBQVM7UUFDVCxZQUFZO1FBQ1osWUFBWTtLQUNiLENBQUM7SUFDRixPQUFPLE1BQU0sQ0FBQztBQUNoQixDQUFDLENBQUM7QUFDRixNQUFNLENBQUMsTUFBTSxnQkFBZ0IsR0FBRyxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsQ0FBQztBQUMvQyxNQUFNLENBQUMsTUFBTSxrQkFBa0IsR0FBZTtJQUM1QyxJQUFJLEVBQUUsUUFBUTtJQUNk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QyxtQkFBbUIsQ0FDekIsQ0FBQztJQUVGLDhEQUE4RDtJQUM5RCxrREFBa0Q7SUFDbEQsTUFBTSxDQUFDLGNBQWMsQ0FBQyxLQUFLLEVBQUUsU0FBUyxFQUFFLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUM7SUFFMUQsT0FBTyxLQUFLLENBQUM7QUFDZixDQUFDLENBQUM7QUFDRiwrQ0FBK0M7QUFDL0MsTUFBTSxhQUFhLEdBQUcsQ0FBQyxJQUFtQixFQUFFLEtBQVksRUFBUyxFQUFFO0lBQ2pFLElBQUksQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDMUIsT0FBTyxLQUFLLENBQUM7QUFDZixDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICBUaGUgTUlUIExpY2Vuc2VcbiAgXG4gIENvcHlyaWdodCAoYykgMjAxNy0yMDE5IEVjbGlwc2VTb3VyY2UgTXVuaWNoXG4gIGh0dHBzOi8vZ2l0aHViLmNvbS9lY2xpcHNlc291cmNlL2pzb25mb3Jtc1xuICBcbiAgUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weVxuICBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0byBkZWFsXG4gIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHNcbiAgdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbFxuICBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXNcbiAgZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczpcbiAgXG4gIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluXG4gIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuICBcbiAgVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxuICBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcbiAgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFXG4gIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcbiAgTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSxcbiAgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTlxuICBUSEUgU09GVFdBUkUuXG4qL1xuaW1wb3J0IHR5cGUgeyBEZWJ1Z0VsZW1lbnQsIFR5cGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IENvbXBvbmVudEZpeHR1cmUsIFRlc3RCZWQgfSBmcm9tICdAYW5ndWxhci9jb3JlL3Rlc3RpbmcnO1xuaW1wb3J0IHsgQnkgfSBmcm9tICdAYW5ndWxhci9wbGF0Zm9ybS1icm93c2VyJztcblxuaW1wb3J0IHR5cGUgeyBKc29uRm9ybXNDb250cm9sIH0gZnJvbSAnQGpzb25mb3Jtcy9hbmd1bGFyJztcbmltcG9ydCB7XG4gIGJhc2VTZXR1cCxcbiAgRXJyb3JUZXN0RXhwZWN0YXRpb24sXG4gIHNldHVwTW9ja1N0b3JlLFxuICBUZXN0Q29uZmlnLFxuICBUZXN0RGF0YSxcbiAgZ2V0SnNvbkZvcm1zU2VydmljZSxcbn0gZnJvbSAnLi91dGlsJztcbmltcG9ydCB7IENvbnRyb2xFbGVtZW50LCBKc29uU2NoZW1hLCBBY3Rpb25zIH0gZnJvbSAnQGpzb25mb3Jtcy9jb3JlJztcblxuaW50ZXJmYWNlIENvbXBvbmVudFJlc3VsdDxDIGV4dGVuZHMgSnNvbkZvcm1zQ29udHJvbD4ge1xuICBmaXh0dXJlOiBDb21wb25lbnRGaXh0dXJlPGFueT47XG4gIGNvbXBvbmVudDogQztcbiAgcmFuZ2VFbGVtZW50OiBEZWJ1Z0VsZW1lbnQ7XG4gIHRodW1iRWxlbWVudDogRGVidWdFbGVtZW50O1xufVxuXG5jb25zdCBwcmVwYXJlQ29tcG9uZW50ID0gPEMgZXh0ZW5kcyBKc29uRm9ybXNDb250cm9sLCBJPihcbiAgdGVzdENvbmZpZzogVGVzdENvbmZpZzxDPixcbiAgaW5zdGFuY2U6IFR5cGU8ST5cbik6IENvbXBvbmVudFJlc3VsdDxDPiA9PiB7XG4gIGNvbnN0IGZpeHR1cmUgPSBUZXN0QmVkLmNyZWF0ZUNvbXBvbmVudCh0ZXN0Q29uZmlnLmNvbXBvbmVudFVUKTtcbiAgY29uc3QgY29tcG9uZW50ID0gZml4dHVyZS5jb21wb25lbnRJbnN0YW5jZTtcbiAgY29uc3QgcmFuZ2VFbGVtZW50ID0gZml4dHVyZS5kZWJ1Z0VsZW1lbnQucXVlcnkoQnkuZGlyZWN0aXZlKGluc3RhbmNlKSk7XG4gIGNvbnN0IHRodW1iRWxlbWVudCA9IGZpeHR1cmUuZGVidWdFbGVtZW50LnF1ZXJ5KEJ5LmNzcygnW21hdHNsaWRlcnRodW1iXScpKTsgLy9yYW5nZUVsZW1lbnQubmF0aXZlRWxlbWVudC5jaGlsZHJlblswXTsgLy8gdG9kbzogZmluZCBhIHNhZmVyIHdheSB0byBnZXQgdGhlICdtYXRTbGlkZXJUaHVtYidcbiAgY29uc3QgcmVzdWx0OiBDb21wb25lbnRSZXN1bHQ8Qz4gPSB7XG4gICAgZml4dHVyZSxcbiAgICBjb21wb25lbnQsXG4gICAgcmFuZ2VFbGVtZW50LFxuICAgIHRodW1iRWxlbWVudCxcbiAgfTtcbiAgcmV0dXJuIHJlc3VsdDtcbn07XG5leHBvcnQgY29uc3QgcmFuZ2VEZWZhdWx0RGF0YSA9IHsgZm9vOiAxLjIzNCB9O1xuZXhwb3J0IGNvbnN0IHJhbmdlRGVmYXVsdFNjaGVtYTogSnNvblNjaGVtYSA9IHtcbiAgdHlwZTogJ29iamVjdCcsXG4gIHByb3BlcnRpZXM6IHtcbiAgICBmb286IHtcbiAgICAgIHR5cGU6ICdudW1iZXInLFxuICAgICAgbWluaW11bTogLTQyLjQyLFxuICAgICAgbWF4aW11bTogNDIuNDIsXG4gICAgICBkZWZhdWx0OiAwLjQyLFxuICAgIH0sXG4gIH0sXG59O1xuZXhwb3J0IGNvbnN0IHJhbmdlRGVmYXVsdFVpc2NoZW1hOiBDb250cm9sRWxlbWVudCA9IHtcbiAgdHlwZTogJ0NvbnRyb2wnLFxuICBzY29wZTogJyMvcHJvcGVydGllcy9mb28nLFxuICBvcHRpb25zOiB7IHNsaWRlcjogdHJ1ZSB9LFxufTtcbmV4cG9ydCBjb25zdCByYW5nZURlZmF1bHRUZXN0RGF0YTogVGVzdERhdGE8Q29udHJvbEVsZW1lbnQ+ID0ge1xuICBkYXRhOiByYW5nZURlZmF1bHREYXRhLFxuICBzY2hlbWE6IHJhbmdlRGVmYXVsdFNjaGVtYSxcbiAgdWlzY2hlbWE6IHJhbmdlRGVmYXVsdFVpc2NoZW1hLFxufTtcblxuZXhwb3J0IGNvbnN0IHJhbmdlQmFzZVRlc3QgPVxuICA8QyBleHRlbmRzIEpzb25Gb3Jtc0NvbnRyb2wsIEk+KFxuICAgIHRlc3RDb25maWc6IFRlc3RDb25maWc8Qz4sXG4gICAgaW5zdGFuY2U6IFR5cGU8ST5cbiAgKSA9PlxuICAoKSA9PiB7XG4gICAgbGV0IGZpeHR1cmU6IENvbXBvbmVudEZpeHR1cmU8YW55PjtcbiAgICBsZXQgcmFuZ2VFbGVtZW50OiBEZWJ1Z0VsZW1lbnQ7XG4gICAgbGV0IHRodW1iRWxlbWVudDogRGVidWdFbGVtZW50O1xuICAgIGxldCBjb21wb25lbnQ6IEM7XG5cbiAgICBiYXNlU2V0dXAodGVzdENvbmZpZyk7XG5cbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIGNvbnN0IHByZXBhcmVkQ29tcG9uZW50cyA9IHByZXBhcmVDb21wb25lbnQodGVzdENvbmZpZywgaW5zdGFuY2UpO1xuICAgICAgZml4dHVyZSA9IHByZXBhcmVkQ29tcG9uZW50cy5maXh0dXJlO1xuICAgICAgcmFuZ2VFbGVtZW50ID0gcHJlcGFyZWRDb21wb25lbnRzLnJhbmdlRWxlbWVudDtcbiAgICAgIHRodW1iRWxlbWVudCA9IHByZXBhcmVkQ29tcG9uZW50cy50aHVtYkVsZW1lbnQ7XG4gICAgICBjb21wb25lbnQgPSBwcmVwYXJlZENvbXBvbmVudHMuY29tcG9uZW50O1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZW5kZXIgZmxvYXRzJywgKCkgPT4ge1xuICAgICAgY29tcG9uZW50LnVpc2NoZW1hID0gcmFuZ2VEZWZhdWx0VGVzdERhdGEudWlzY2hlbWE7XG4gICAgICBjb21wb25lbnQuc2NoZW1hID0gcmFuZ2VEZWZhdWx0VGVzdERhdGEuc2NoZW1hO1xuXG4gICAgICBnZXRKc29uRm9ybXNTZXJ2aWNlKGNvbXBvbmVudCkuaW5pdCh7XG4gICAgICAgIGNvcmU6IHtcbiAgICAgICAgICBkYXRhOiByYW5nZURlZmF1bHRUZXN0RGF0YS5kYXRhLFxuICAgICAgICAgIHNjaGVtYTogcmFuZ2VEZWZhdWx0VGVzdERhdGEuc2NoZW1hLFxuICAgICAgICAgIHVpc2NoZW1hOiByYW5nZURlZmF1bHRUZXN0RGF0YS51aXNjaGVtYSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgICAgY29tcG9uZW50Lm5nT25Jbml0KCk7XG4gICAgICBmaXh0dXJlLmRldGVjdENoYW5nZXMoKTtcbiAgICAgIGV4cGVjdChjb21wb25lbnQuZGF0YSkudG9CZSgxLjIzNCk7XG4gICAgICBleHBlY3QodGh1bWJFbGVtZW50LmNvbXBvbmVudEluc3RhbmNlLmRhdGEpLnRvQmUoMS4yMzQpO1xuICAgICAgLy8gc3RlcCBpcyBvZiB0eXBlIHN0cmluZ1xuICAgICAgZXhwZWN0KHJhbmdlRWxlbWVudC5jb21wb25lbnRJbnN0YW5jZS5zdGVwKS50b0JlKDEpO1xuICAgICAgZXhwZWN0KHJhbmdlRWxlbWVudC5jb21wb25lbnRJbnN0YW5jZS5taW4pLnRvQmUoLTQyLjQyKTtcbiAgICAgIGV4cGVjdChyYW5nZUVsZW1lbnQuY29tcG9uZW50SW5zdGFuY2UubWF4KS50b0JlKDQyLjQyKTtcbiAgICAgIGV4cGVjdChyYW5nZUVsZW1lbnQuY29tcG9uZW50SW5zdGFuY2UuZGlzYWJsZWQpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KGZpeHR1cmUubmF0aXZlRWxlbWVudC5jaGlsZHJlblswXS5zdHlsZS5kaXNwbGF5KS5ub3QudG9CZSgnbm9uZScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZW5kZXIgaW50ZWdlcicsICgpID0+IHtcbiAgICAgIGNvbXBvbmVudC51aXNjaGVtYSA9IHJhbmdlRGVmYXVsdFRlc3REYXRhLnVpc2NoZW1hO1xuICAgICAgY29uc3Qgc2NoZW1hID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShyYW5nZURlZmF1bHRUZXN0RGF0YS5zY2hlbWEpKTtcbiAgICAgIHNjaGVtYS5wcm9wZXJ0aWVzLmZvby50eXBlID0gJ2ludGVnZXInO1xuICAgICAgc2NoZW1hLnByb3BlcnRpZXMuZm9vLm1pbmltdW0gPSAtNDI7XG4gICAgICBzY2hlbWEucHJvcGVydGllcy5mb28ubWF4aW11bSA9IDQyO1xuICAgICAgc2NoZW1hLnByb3BlcnRpZXMuZm9vLmRlZmF1bHQgPSAxO1xuICAgICAgc2V0dXBNb2NrU3RvcmUoZml4dHVyZSwge1xuICAgICAgICB1aXNjaGVtYTogcmFuZ2VEZWZhdWx0VGVzdERhdGEudWlzY2hlbWEsXG4gICAgICAgIHNjaGVtYSxcbiAgICAgICAgZGF0YTogeyBmb286IDEyIH0sXG4gICAgICB9KTtcbiAgICAgIGdldEpzb25Gb3Jtc1NlcnZpY2UoY29tcG9uZW50KS51cGRhdGVDb3JlKFxuICAgICAgICBBY3Rpb25zLmluaXQoeyBmb286IDEyIH0sIHNjaGVtYSwgcmFuZ2VEZWZhdWx0VGVzdERhdGEudWlzY2hlbWEpXG4gICAgICApO1xuXG4gICAgICBmaXh0dXJlLmNvbXBvbmVudEluc3RhbmNlLm5nT25Jbml0KCk7XG4gICAgICBmaXh0dXJlLmRldGVjdENoYW5nZXMoKTtcbiAgICAgIGV4cGVjdChjb21wb25lbnQuZGF0YSkudG9CZSgxMik7XG4gICAgICBleHBlY3QodGh1bWJFbGVtZW50LmNvbXBvbmVudEluc3RhbmNlLmRhdGEpLnRvQmUoMTIpO1xuICAgICAgLy8gc3RlcCBpcyBvZiB0eXBlIHN0cmluZ1xuICAgICAgZXhwZWN0KHJhbmdlRWxlbWVudC5jb21wb25lbnRJbnN0YW5jZS5zdGVwKS50b0JlKDEpO1xuICAgICAgZXhwZWN0KHJhbmdlRWxlbWVudC5jb21wb25lbnRJbnN0YW5jZS5taW4pLnRvQmUoLTQyKTtcbiAgICAgIGV4cGVjdChyYW5nZUVsZW1lbnQuY29tcG9uZW50SW5zdGFuY2UubWF4KS50b0JlKDQyKTtcbiAgICAgIGV4cGVjdChyYW5nZUVsZW1lbnQuY29tcG9uZW50SW5zdGFuY2UuZGlzYWJsZWQpLnRvQmUoZmFsc2UpO1xuICAgICAgLy8gdGhlIGNvbXBvbmVudCBpcyB3cmFwcGVkIGluIGEgZGl2XG4gICAgICBleHBlY3QoZml4dHVyZS5uYXRpdmVFbGVtZW50LmNoaWxkcmVuWzBdLnN0eWxlLmRpc3BsYXkpLm5vdC50b0JlKCdub25lJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHN1cHBvcnQgdXBkYXRpbmcgdGhlIHN0YXRlJywgKCkgPT4ge1xuICAgICAgY29tcG9uZW50LnVpc2NoZW1hID0gcmFuZ2VEZWZhdWx0VGVzdERhdGEudWlzY2hlbWE7XG4gICAgICBjb21wb25lbnQuc2NoZW1hID0gcmFuZ2VEZWZhdWx0VGVzdERhdGEuc2NoZW1hO1xuXG4gICAgICBnZXRKc29uRm9ybXNTZXJ2aWNlKGNvbXBvbmVudCkuaW5pdCh7XG4gICAgICAgIGNvcmU6IHtcbiAgICAgICAgICBkYXRhOiByYW5nZURlZmF1bHRUZXN0RGF0YS5kYXRhLFxuICAgICAgICAgIHNjaGVtYTogcmFuZ2VEZWZhdWx0VGVzdERhdGEuc2NoZW1hLFxuICAgICAgICAgIHVpc2NoZW1hOiByYW5nZURlZmF1bHRUZXN0RGF0YS51aXNjaGVtYSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgICAgY29tcG9uZW50Lm5nT25Jbml0KCk7XG4gICAgICBmaXh0dXJlLmRldGVjdENoYW5nZXMoKTtcblxuICAgICAgZ2V0SnNvbkZvcm1zU2VydmljZShjb21wb25lbnQpLnVwZGF0ZUNvcmUoXG4gICAgICAgIEFjdGlvbnMudXBkYXRlKCdmb28nLCAoKSA9PiA0LjU2KVxuICAgICAgKTtcbiAgICAgIGZpeHR1cmUuZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgZXhwZWN0KGNvbXBvbmVudC5kYXRhKS50b0JlKDQuNTYpO1xuICAgICAgZXhwZWN0KHRodW1iRWxlbWVudC5jb21wb25lbnRJbnN0YW5jZS5kYXRhKS50b0JlKDQuNTYpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgdXBkYXRlIHdpdGggdW5kZWZpbmVkIHZhbHVlJywgKCkgPT4ge1xuICAgICAgY29tcG9uZW50LnVpc2NoZW1hID0gcmFuZ2VEZWZhdWx0VGVzdERhdGEudWlzY2hlbWE7XG4gICAgICBjb21wb25lbnQuc2NoZW1hID0gcmFuZ2VEZWZhdWx0VGVzdERhdGEuc2NoZW1hO1xuXG4gICAgICBnZXRKc29uRm9ybXNTZXJ2aWNlKGNvbXBvbmVudCkuaW5pdCh7XG4gICAgICAgIGNvcmU6IHtcbiAgICAgICAgICBkYXRhOiByYW5nZURlZmF1bHRUZXN0RGF0YS5kYXRhLFxuICAgICAgICAgIHNjaGVtYTogcmFuZ2VEZWZhdWx0VGVzdERhdGEuc2NoZW1hLFxuICAgICAgICAgIHVpc2NoZW1hOiByYW5nZURlZmF1bHRUZXN0RGF0YS51aXNjaGVtYSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgICAgY29tcG9uZW50Lm5nT25Jbml0KCk7XG4gICAgICBmaXh0dXJlLmRldGVjdENoYW5nZXMoKTtcblxuICAgICAgZ2V0SnNvbkZvcm1zU2VydmljZShjb21wb25lbnQpLnVwZGF0ZUNvcmUoXG4gICAgICAgIEFjdGlvbnMudXBkYXRlKCdmb28nLCAoKSA9PiB1bmRlZmluZWQpXG4gICAgICApO1xuICAgICAgZml4dHVyZS5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgICBleHBlY3QoY29tcG9uZW50LmRhdGEpLnRvQmUodW5kZWZpbmVkKTtcbiAgICAgIGV4cGVjdCh0aHVtYkVsZW1lbnQuY29tcG9uZW50SW5zdGFuY2UuZGF0YSkudG9CZSh1bmRlZmluZWQpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgdXBkYXRlIHdpdGggbnVsbCB2YWx1ZScsICgpID0+IHtcbiAgICAgIGNvbXBvbmVudC51aXNjaGVtYSA9IHJhbmdlRGVmYXVsdFRlc3REYXRhLnVpc2NoZW1hO1xuICAgICAgY29tcG9uZW50LnNjaGVtYSA9IHJhbmdlRGVmYXVsdFRlc3REYXRhLnNjaGVtYTtcblxuICAgICAgZ2V0SnNvbkZvcm1zU2VydmljZShjb21wb25lbnQpLmluaXQoe1xuICAgICAgICBjb3JlOiB7XG4gICAgICAgICAgZGF0YTogcmFuZ2VEZWZhdWx0VGVzdERhdGEuZGF0YSxcbiAgICAgICAgICBzY2hlbWE6IHJhbmdlRGVmYXVsdFRlc3REYXRhLnNjaGVtYSxcbiAgICAgICAgICB1aXNjaGVtYTogcmFuZ2VEZWZhdWx0VGVzdERhdGEudWlzY2hlbWEsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICAgIGNvbXBvbmVudC5uZ09uSW5pdCgpO1xuICAgICAgZml4dHVyZS5kZXRlY3RDaGFuZ2VzKCk7XG5cbiAgICAgIGdldEpzb25Gb3Jtc1NlcnZpY2UoY29tcG9uZW50KS51cGRhdGVDb3JlKFxuICAgICAgICBBY3Rpb25zLnVwZGF0ZSgnZm9vJywgKCkgPT4gbnVsbClcbiAgICAgICk7XG4gICAgICBmaXh0dXJlLmRldGVjdENoYW5nZXMoKTtcbiAgICAgIGV4cGVjdChjb21wb25lbnQuZGF0YSkudG9CZShudWxsKTtcbiAgICAgIGV4cGVjdCh0aHVtYkVsZW1lbnQuY29tcG9uZW50SW5zdGFuY2UuZGF0YSkudG9CZShudWxsKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIG5vdCB1cGRhdGUgd2l0aCB3cm9uZyByZWYnLCAoKSA9PiB7XG4gICAgICBjb21wb25lbnQudWlzY2hlbWEgPSByYW5nZURlZmF1bHRUZXN0RGF0YS51aXNjaGVtYTtcbiAgICAgIGNvbXBvbmVudC5zY2hlbWEgPSByYW5nZURlZmF1bHRUZXN0RGF0YS5zY2hlbWE7XG5cbiAgICAgIGdldEpzb25Gb3Jtc1NlcnZpY2UoY29tcG9uZW50KS5pbml0KHtcbiAgICAgICAgY29yZToge1xuICAgICAgICAgIGRhdGE6IHJhbmdlRGVmYXVsdFRlc3REYXRhLmRhdGEsXG4gICAgICAgICAgc2NoZW1hOiByYW5nZURlZmF1bHRUZXN0RGF0YS5zY2hlbWEsXG4gICAgICAgICAgdWlzY2hlbWE6IHJhbmdlRGVmYXVsdFRlc3REYXRhLnVpc2NoZW1hLFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgICBjb21wb25lbnQubmdPbkluaXQoKTtcbiAgICAgIGZpeHR1cmUuZGV0ZWN0Q2hhbmdlcygpO1xuXG4gICAgICBnZXRKc29uRm9ybXNTZXJ2aWNlKGNvbXBvbmVudCkudXBkYXRlQ29yZShcbiAgICAgICAgQWN0aW9ucy51cGRhdGUoJ2ZvbycsICgpID0+IDEuMjM0KVxuICAgICAgKTtcbiAgICAgIGdldEpzb25Gb3Jtc1NlcnZpY2UoY29tcG9uZW50KS51cGRhdGVDb3JlKFxuICAgICAgICBBY3Rpb25zLnVwZGF0ZSgnYmFyJywgKCkgPT4gNDU2LjQ1NilcbiAgICAgICk7XG5cbiAgICAgIGZpeHR1cmUuZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgZXhwZWN0KGNvbXBvbmVudC5kYXRhKS50b0JlKDEuMjM0KTtcbiAgICAgIGV4cGVjdCh0aHVtYkVsZW1lbnQuY29tcG9uZW50SW5zdGFuY2UuZGF0YSkudG9CZSgxLjIzNCk7XG4gICAgfSk7XG4gICAgLy8gc3RvcmUgbmVlZGVkIGFzIHdlIGV2YWx1YXRlIHRoZSBjYWxjdWxhdGVkIGVuYWJsZWQgdmFsdWUgdG8gZGlzYWJsZS9lbmFibGUgdGhlIGNvbnRyb2xcbiAgICBpdCgnY2FuIGJlIGRpc2FibGVkJywgKCkgPT4ge1xuICAgICAgY29tcG9uZW50LnVpc2NoZW1hID0gcmFuZ2VEZWZhdWx0VGVzdERhdGEudWlzY2hlbWE7XG4gICAgICBjb21wb25lbnQuc2NoZW1hID0gcmFuZ2VEZWZhdWx0VGVzdERhdGEuc2NoZW1hO1xuICAgICAgY29tcG9uZW50LmRpc2FibGVkID0gdHJ1ZTtcblxuICAgICAgZ2V0SnNvbkZvcm1zU2VydmljZShjb21wb25lbnQpLmluaXQoe1xuICAgICAgICBjb3JlOiB7XG4gICAgICAgICAgZGF0YTogcmFuZ2VEZWZhdWx0VGVzdERhdGEuZGF0YSxcbiAgICAgICAgICBzY2hlbWE6IHJhbmdlRGVmYXVsdFRlc3REYXRhLnNjaGVtYSxcbiAgICAgICAgICB1aXNjaGVtYTogcmFuZ2VEZWZhdWx0VGVzdERhdGEudWlzY2hlbWEsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICAgIGNvbXBvbmVudC5uZ09uSW5pdCgpO1xuICAgICAgZml4dHVyZS5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgICBleHBlY3QocmFuZ2VFbGVtZW50LmNvbXBvbmVudEluc3RhbmNlLmRpc2FibGVkKS50b0JlKHRydWUpO1xuICAgIH0pO1xuICAgIGl0KCdjYW4gYmUgaGlkZGVuJywgKCkgPT4ge1xuICAgICAgY29tcG9uZW50LnVpc2NoZW1hID0gcmFuZ2VEZWZhdWx0VGVzdERhdGEudWlzY2hlbWE7XG4gICAgICBjb21wb25lbnQuc2NoZW1hID0gcmFuZ2VEZWZhdWx0VGVzdERhdGEuc2NoZW1hO1xuICAgICAgY29tcG9uZW50LnZpc2libGUgPSBmYWxzZTtcblxuICAgICAgZ2V0SnNvbkZvcm1zU2VydmljZShjb21wb25lbnQpLmluaXQoe1xuICAgICAgICBjb3JlOiB7XG4gICAgICAgICAgZGF0YTogcmFuZ2VEZWZhdWx0VGVzdERhdGEuZGF0YSxcbiAgICAgICAgICBzY2hlbWE6IHJhbmdlRGVmYXVsdFRlc3REYXRhLnNjaGVtYSxcbiAgICAgICAgICB1aXNjaGVtYTogcmFuZ2VEZWZhdWx0VGVzdERhdGEudWlzY2hlbWEsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICAgIGZpeHR1cmUuZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgY29tcG9uZW50Lm5nT25Jbml0KCk7XG4gICAgICBleHBlY3QoZml4dHVyZS5uYXRpdmVFbGVtZW50LmNoaWxkcmVuWzBdLnN0eWxlLmRpc3BsYXkpLnRvQmUoJ25vbmUnKTtcbiAgICB9KTtcbiAgICBpdCgnaWQgc2hvdWxkIGJlIHByZXNlbnQgaW4gb3V0cHV0JywgKCkgPT4ge1xuICAgICAgY29tcG9uZW50LnVpc2NoZW1hID0gcmFuZ2VEZWZhdWx0VGVzdERhdGEudWlzY2hlbWE7XG4gICAgICBjb21wb25lbnQuc2NoZW1hID0gcmFuZ2VEZWZhdWx0VGVzdERhdGEuc2NoZW1hO1xuICAgICAgY29tcG9uZW50LmlkID0gJ215SWQnO1xuICAgICAgZ2V0SnNvbkZvcm1zU2VydmljZShjb21wb25lbnQpLmluaXQoe1xuICAgICAgICBjb3JlOiB7XG4gICAgICAgICAgZGF0YTogcmFuZ2VEZWZhdWx0VGVzdERhdGEuZGF0YSxcbiAgICAgICAgICBzY2hlbWE6IHJhbmdlRGVmYXVsdFRlc3REYXRhLnNjaGVtYSxcbiAgICAgICAgICB1aXNjaGVtYTogcmFuZ2VEZWZhdWx0VGVzdERhdGEudWlzY2hlbWEsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICAgIGNvbXBvbmVudC5uZ09uSW5pdCgpO1xuICAgICAgZml4dHVyZS5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgICBleHBlY3QocmFuZ2VFbGVtZW50Lm5hdGl2ZUVsZW1lbnQuaWQpLnRvQmUoJ215SWQnKTtcbiAgICB9KTtcbiAgfTtcbmV4cG9ydCBjb25zdCByYW5nZUlucHV0RXZlbnRUZXN0ID1cbiAgPEMgZXh0ZW5kcyBKc29uRm9ybXNDb250cm9sLCBJPihcbiAgICB0ZXN0Q29uZmlnOiBUZXN0Q29uZmlnPEM+LFxuICAgIGluc3RhbmNlOiBUeXBlPEk+XG4gICkgPT5cbiAgKCkgPT4ge1xuICAgIGxldCBmaXh0dXJlOiBDb21wb25lbnRGaXh0dXJlPGFueT47XG4gICAgbGV0IGNvbXBvbmVudDogQztcblxuICAgIGJhc2VTZXR1cCh0ZXN0Q29uZmlnKTtcblxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgY29uc3QgcHJlcGFyZWRDb21wb25lbnRzID0gcHJlcGFyZUNvbXBvbmVudCh0ZXN0Q29uZmlnLCBpbnN0YW5jZSk7XG4gICAgICBmaXh0dXJlID0gcHJlcGFyZWRDb21wb25lbnRzLmZpeHR1cmU7XG4gICAgICBjb21wb25lbnQgPSBwcmVwYXJlZENvbXBvbmVudHMuY29tcG9uZW50O1xuICAgIH0pO1xuXG4gICAgeGl0KCdzaG91bGQgdXBkYXRlIHZpYSBpbnB1dCBldmVudCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbXBvbmVudC51aXNjaGVtYSA9IHJhbmdlRGVmYXVsdFRlc3REYXRhLnVpc2NoZW1hO1xuICAgICAgY29tcG9uZW50LnNjaGVtYSA9IHJhbmdlRGVmYXVsdFRlc3REYXRhLnNjaGVtYTtcblxuICAgICAgZ2V0SnNvbkZvcm1zU2VydmljZShjb21wb25lbnQpLmluaXQoe1xuICAgICAgICBjb3JlOiB7XG4gICAgICAgICAgZGF0YTogcmFuZ2VEZWZhdWx0VGVzdERhdGEuZGF0YSxcbiAgICAgICAgICBzY2hlbWE6IHJhbmdlRGVmYXVsdFRlc3REYXRhLnNjaGVtYSxcbiAgICAgICAgICB1aXNjaGVtYTogcmFuZ2VEZWZhdWx0VGVzdERhdGEudWlzY2hlbWEsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICAgIGNvbXBvbmVudC5uZ09uSW5pdCgpO1xuICAgICAgZml4dHVyZS5kZXRlY3RDaGFuZ2VzKCk7XG5cbiAgICAgIGNvbnN0IHNweSA9IHNweU9uKGNvbXBvbmVudCwgJ29uQ2hhbmdlJyk7XG5cbiAgICAgIGNvbnN0IHNsaWRlckVsZW1lbnQgPSBmaXh0dXJlLmRlYnVnRWxlbWVudC5xdWVyeShcbiAgICAgICAgQnkuY3NzKCcubWF0LXNsaWRlcicpXG4gICAgICApLm5hdGl2ZUVsZW1lbnQ7XG5cbiAgICAgIGNvbnN0IHRyYWNrRWxlbWVudCA9IGZpeHR1cmUuZGVidWdFbGVtZW50LnF1ZXJ5KFxuICAgICAgICBCeS5jc3MoJy5tYXQtc2xpZGVyLXdyYXBwZXInKVxuICAgICAgKS5uYXRpdmVFbGVtZW50O1xuICAgICAgY29uc3QgZGltZW5zaW9ucyA9IHRyYWNrRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgIGNvbnN0IHggPSBkaW1lbnNpb25zLmxlZnQgKyBkaW1lbnNpb25zLndpZHRoICogMC4yO1xuICAgICAgY29uc3QgeSA9IGRpbWVuc2lvbnMudG9wICsgZGltZW5zaW9ucy5oZWlnaHQgKiAwLjI7XG5cbiAgICAgIGRpc3BhdGNoRXZlbnQoc2xpZGVyRWxlbWVudCwgY3JlYXRlTW91c2VFdmVudCgnbW91c2Vkb3duJywgeCwgeSwgMCkpO1xuXG4gICAgICAvLyB0cmlnZ2VyIGNoYW5nZSBkZXRlY3Rpb25cbiAgICAgIGZpeHR1cmUuZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgYXdhaXQgZml4dHVyZS53aGVuU3RhYmxlKCk7XG4gICAgICBleHBlY3Qoc3B5KS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG4gIH07XG5leHBvcnQgY29uc3QgcmFuZ2VFcnJvclRlc3QgPVxuICA8QyBleHRlbmRzIEpzb25Gb3Jtc0NvbnRyb2wsIEk+KFxuICAgIHRlc3RDb25maWc6IFRlc3RDb25maWc8Qz4sXG4gICAgaW5zdGFuY2U6IFR5cGU8ST4sXG4gICAgZXJyb3JUZXN0SW5mb3JtYXRpb246IEVycm9yVGVzdEV4cGVjdGF0aW9uXG4gICkgPT5cbiAgKCkgPT4ge1xuICAgIGxldCBmaXh0dXJlOiBDb21wb25lbnRGaXh0dXJlPGFueT47XG4gICAgbGV0IGNvbXBvbmVudDogQztcblxuICAgIGJhc2VTZXR1cCh0ZXN0Q29uZmlnKTtcblxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgY29uc3QgcHJlcGFyZWRDb21wb25lbnRzID0gcHJlcGFyZUNvbXBvbmVudCh0ZXN0Q29uZmlnLCBpbnN0YW5jZSk7XG4gICAgICBmaXh0dXJlID0gcHJlcGFyZWRDb21wb25lbnRzLmZpeHR1cmU7XG4gICAgICBjb21wb25lbnQgPSBwcmVwYXJlZENvbXBvbmVudHMuY29tcG9uZW50O1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgZGlzcGxheSBlcnJvcnMnLCAoKSA9PiB7XG4gICAgICBjb21wb25lbnQudWlzY2hlbWEgPSByYW5nZURlZmF1bHRUZXN0RGF0YS51aXNjaGVtYTtcbiAgICAgIGNvbXBvbmVudC5zY2hlbWEgPSByYW5nZURlZmF1bHRUZXN0RGF0YS5zY2hlbWE7XG5cbiAgICAgIGNvbnN0IGZvcm1zU2VydmljZSA9IGdldEpzb25Gb3Jtc1NlcnZpY2UoY29tcG9uZW50KTtcbiAgICAgIGZvcm1zU2VydmljZS5pbml0KHtcbiAgICAgICAgY29yZToge1xuICAgICAgICAgIGRhdGE6IHJhbmdlRGVmYXVsdFRlc3REYXRhLmRhdGEsXG4gICAgICAgICAgc2NoZW1hOiByYW5nZURlZmF1bHRUZXN0RGF0YS5zY2hlbWEsXG4gICAgICAgICAgdWlzY2hlbWE6IHVuZGVmaW5lZCxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgICAgZm9ybXNTZXJ2aWNlLnVwZGF0ZUNvcmUoXG4gICAgICAgIEFjdGlvbnMudXBkYXRlRXJyb3JzKFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBpbnN0YW5jZVBhdGg6ICcvZm9vJyxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdIaSwgdGhpcyBpcyBtZSwgdGVzdCBlcnJvciEnLFxuICAgICAgICAgICAga2V5d29yZDogJycsXG4gICAgICAgICAgICBzY2hlbWFQYXRoOiAnJyxcbiAgICAgICAgICAgIHBhcmFtczoge30sXG4gICAgICAgICAgfSxcbiAgICAgICAgXSlcbiAgICAgICk7XG4gICAgICBmb3Jtc1NlcnZpY2UucmVmcmVzaCgpO1xuXG4gICAgICBjb21wb25lbnQubmdPbkluaXQoKTtcbiAgICAgIGZpeHR1cmUuZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgY29uc3QgZGVidWdFcnJvcnM6IERlYnVnRWxlbWVudFtdID0gZml4dHVyZS5kZWJ1Z0VsZW1lbnQucXVlcnlBbGwoXG4gICAgICAgIEJ5LmRpcmVjdGl2ZShlcnJvclRlc3RJbmZvcm1hdGlvbi5lcnJvckluc3RhbmNlKVxuICAgICAgKTtcbiAgICAgIGV4cGVjdChkZWJ1Z0Vycm9ycy5sZW5ndGgpLnRvQmUoZXJyb3JUZXN0SW5mb3JtYXRpb24ubnVtYmVyT2ZFbGVtZW50cyk7XG4gICAgICBleHBlY3QoXG4gICAgICAgIGRlYnVnRXJyb3JzW2Vycm9yVGVzdEluZm9ybWF0aW9uLmluZGV4T2ZFbGVtZW50XS5uYXRpdmVFbGVtZW50XG4gICAgICAgICAgLnRleHRDb250ZW50XG4gICAgICApLnRvQmUoJ0hpLCB0aGlzIGlzIG1lLCB0ZXN0IGVycm9yIScpO1xuICAgIH0pO1xuICB9O1xuXG4vKiogQ3JlYXRlcyBhIGJyb3dzZXIgTW91c2VFdmVudCB3aXRoIHRoZSBzcGVjaWZpZWQgb3B0aW9ucy4gKi9cbmNvbnN0IGNyZWF0ZU1vdXNlRXZlbnQgPSAodHlwZTogc3RyaW5nLCB4ID0gMCwgeSA9IDAsIGJ1dHRvbiA9IDApID0+IHtcbiAgY29uc3QgZXZlbnQgPSBkb2N1bWVudC5jcmVhdGVFdmVudCgnTW91c2VFdmVudCcpO1xuXG4gIGV2ZW50LmluaXRNb3VzZUV2ZW50KFxuICAgIHR5cGUsXG4gICAgdHJ1ZSAvKiBjYW5CdWJibGUgKi8sXG4gICAgZmFsc2UgLyogY2FuY2VsYWJsZSAqLyxcbiAgICB3aW5kb3cgLyogdmlldyAqLyxcbiAgICAwIC8qIGRldGFpbCAqLyxcbiAgICB4IC8qIHNjcmVlblggKi8sXG4gICAgeSAvKiBzY3JlZW5ZICovLFxuICAgIHggLyogY2xpZW50WCAqLyxcbiAgICB5IC8qIGNsaWVudFkgKi8sXG4gICAgZmFsc2UgLyogY3RybEtleSAqLyxcbiAgICBmYWxzZSAvKiBhbHRLZXkgKi8sXG4gICAgZmFsc2UgLyogc2hpZnRLZXkgKi8sXG4gICAgZmFsc2UgLyogbWV0YUtleSAqLyxcbiAgICBidXR0b24gLyogYnV0dG9uICovLFxuICAgIG51bGwgLyogcmVsYXRlZFRhcmdldCAqL1xuICApO1xuXG4gIC8vIGBpbml0TW91c2VFdmVudGAgZG9lc24ndCBhbGxvdyB1cyB0byBwYXNzIHRoZSBgYnV0dG9uc2AgYW5kXG4gIC8vIGRlZmF1bHRzIGl0IHRvIDAgd2hpY2ggbG9va3MgbGlrZSBhIGZha2UgZXZlbnQuXG4gIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShldmVudCwgJ2J1dHRvbnMnLCB7IGdldDogKCkgPT4gMSB9KTtcblxuICByZXR1cm4gZXZlbnQ7XG59O1xuLyoqIFV0aWxpdHkgdG8gZGlzcGF0Y2ggYW55IGV2ZW50IG9uIGEgTm9kZS4gKi9cbmNvbnN0IGRpc3BhdGNoRXZlbnQgPSAobm9kZTogTm9kZSB8IFdpbmRvdywgZXZlbnQ6IEV2ZW50KTogRXZlbnQgPT4ge1xuICBub2RlLmRpc3BhdGNoRXZlbnQoZXZlbnQpO1xuICByZXR1cm4gZXZlbnQ7XG59O1xuIl19