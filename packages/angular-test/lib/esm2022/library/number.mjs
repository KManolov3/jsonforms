import { TestBed } from '@angular/core/testing';
import { By } from '@angular/platform-browser';
import { Actions } from '@jsonforms/core';
import { baseSetup, getJsonFormsService, setupMockStore, } from './util';
export const prepareComponent = (testConfig, instance, elementToUse) => {
    const fixture = TestBed.createComponent(testConfig.componentUT);
    const component = fixture.componentInstance;
    const result = { fixture, component };
    if (instance && elementToUse) {
        const numberElement = fixture.debugElement.query(By.css(instance));
        const numberNativeElement = elementToUse(numberElement);
        result.numberElement = numberElement;
        result.numberNativeElement = numberNativeElement;
    }
    return result;
};
const defaultData = { foo: 123.123 };
const defaultSchema = {
    type: 'object',
    properties: {
        foo: {
            type: 'number',
        },
    },
};
const defaultUischema = {
    type: 'Control',
    scope: '#/properties/foo',
};
export const defaultNumberTestData = {
    data: defaultData,
    schema: defaultSchema,
    uischema: defaultUischema,
};
export const updateWithSiblingNumberValue = (fixture, testData, expectations) => {
    setupMockStore(fixture, testData);
    getJsonFormsService(fixture.componentInstance).init({
        core: {
            data: { foo: 123.123, bar: 456.456 },
            schema: testData.schema,
            uischema: undefined,
        },
    });
    fixture.componentInstance.ngOnInit();
    fixture.detectChanges();
    expectations();
};
export const numberBaseTest = (testConfig, instance, elementToUse, testData = defaultNumberTestData) => () => {
    let fixture;
    let numberElement;
    let numberNativeElement;
    let component;
    baseSetup(testConfig);
    beforeEach(() => {
        const preparedComponents = prepareComponent(testConfig, instance, elementToUse);
        fixture = preparedComponents.fixture;
        numberNativeElement = preparedComponents.numberNativeElement;
        numberElement = preparedComponents.numberElement;
        component = preparedComponents.component;
    });
    it('should render floats', () => {
        component.uischema = testData.uischema;
        getJsonFormsService(component).init({ core: testData });
        getJsonFormsService(component).updateCore(Actions.init(testData.data, testData.schema));
        component.ngOnInit();
        fixture.detectChanges();
        expect(component.data).toBe(123.123);
        expect(numberNativeElement.value).toBe('123.123');
        // step is of type string
        expect(numberNativeElement.step).toBe('0.1');
        expect(numberNativeElement.disabled).toBe(false);
        // the component is wrapped in a div
        expect(fixture.nativeElement.children[0].style.display).not.toBe('none');
    });
    it('should render integers', () => {
        const state = {
            data: { foo: 123 },
            schema: {
                type: 'object',
                properties: {
                    foo: { type: 'integer' },
                },
            },
            uischema: testData.uischema,
        };
        component.uischema = testData.uischema;
        getJsonFormsService(component).init({ core: state });
        getJsonFormsService(component).updateCore(Actions.init(state.data, state.schema));
        component.ngOnInit();
        fixture.detectChanges();
        expect(component.data).toBe(123);
        expect(numberNativeElement.value).toBe('123');
        // step is of type string
        expect(numberNativeElement.step).toBe('1');
        expect(numberNativeElement.disabled).toBe(false);
        // the component is wrapped in a div
        expect(fixture.nativeElement.children[0].style.display).not.toBe('none');
    });
    it('should support updating the state', () => {
        component.uischema = testData.uischema;
        getJsonFormsService(component).init({ core: testData });
        getJsonFormsService(component).updateCore(Actions.init(testData.data, testData.schema));
        component.ngOnInit();
        fixture.detectChanges();
        getJsonFormsService(fixture.componentInstance).updateCore(Actions.update('foo', () => 456.456));
        fixture.detectChanges();
        expect(component.data).toBe(456.456);
        expect(Number(numberNativeElement.value)).toBe(456.456);
    });
    it('should update with undefined value', () => {
        component.uischema = testData.uischema;
        getJsonFormsService(component).init({ core: testData });
        getJsonFormsService(component).updateCore(Actions.init(testData.data, testData.schema));
        component.ngOnInit();
        fixture.detectChanges();
        getJsonFormsService(fixture.componentInstance).updateCore(Actions.update('foo', () => undefined));
        fixture.detectChanges();
        expect(component.data).toBe(undefined);
        expect(numberNativeElement.value).toBe('');
    });
    it('should update with null value', () => {
        component.uischema = testData.uischema;
        getJsonFormsService(component).init({ core: testData });
        getJsonFormsService(component).updateCore(Actions.init(testData.data, testData.schema));
        component.ngOnInit();
        fixture.detectChanges();
        getJsonFormsService(fixture.componentInstance).updateCore(Actions.update('foo', () => null));
        fixture.detectChanges();
        expect(component.data).toBe(null);
        expect(numberNativeElement.value).toBe('');
    });
    it('should not update with wrong ref', () => {
        component.uischema = testData.uischema;
        getJsonFormsService(component).init({ core: testData });
        getJsonFormsService(component).updateCore(Actions.init(testData.data, testData.schema));
        component.ngOnInit();
        fixture.detectChanges();
        getJsonFormsService(fixture.componentInstance).updateCore(Actions.update('bar', () => 456.456));
        fixture.detectChanges();
        expect(component.data).toBe(123.123);
        expect(Number(numberNativeElement.value)).toBe(123.123);
    });
    // store needed as we evaluate the calculated enabled value to disable/enable the control
    it('can be disabled', () => {
        component.uischema = testData.uischema;
        component.disabled = true;
        getJsonFormsService(component).init({
            core: {
                data: testData.data,
                schema: testData.schema,
                uischema: testData.uischema,
            },
        });
        component.ngOnInit();
        fixture.detectChanges();
        expect(numberNativeElement.disabled).toBe(true);
    });
    // store needed as we evaluate the calculated enabled value to disable/enable the control
    it('can be hidden', () => {
        component.uischema = testData.uischema;
        component.visible = false;
        getJsonFormsService(component).init({
            core: {
                data: testData.data,
                schema: testData.schema,
                uischema: testData.uischema,
            },
        });
        component.ngOnInit();
        fixture.detectChanges();
        const hasDisplayNone = 'none' === fixture.nativeElement.children[0].style.display;
        const hasHidden = fixture.nativeElement.children[0].hidden;
        expect(hasDisplayNone || hasHidden).toBeTruthy();
    });
    it('id should be present in output', () => {
        component.uischema = testData.uischema;
        component.id = 'myId';
        getJsonFormsService(component).init({
            core: {
                data: testData.data,
                schema: testData.schema,
                uischema: testData.uischema,
            },
        });
        component.ngOnInit();
        fixture.detectChanges();
        expect(numberElement.nativeElement.id).toBe('myId');
    });
};
export const numberInputEventTest = (testConfig, instance, elementToUse, testData = defaultNumberTestData) => () => {
    let fixture;
    let numberNativeElement;
    let component;
    baseSetup(testConfig);
    beforeEach(() => {
        const preparedComponents = prepareComponent(testConfig, instance, elementToUse);
        fixture = preparedComponents.fixture;
        numberNativeElement = preparedComponents.numberNativeElement;
        component = preparedComponents.component;
    });
    it('should update via input event', () => {
        component.uischema = testData.uischema;
        getJsonFormsService(component).init({
            core: {
                data: testData.data,
                schema: testData.schema,
                uischema: undefined,
            },
        });
        fixture.detectChanges();
        component.ngOnInit();
        const spy = spyOn(component, 'onChange');
        numberNativeElement.value = 456.456;
        if (numberNativeElement.dispatchEvent) {
            numberNativeElement.dispatchEvent(new Event('input'));
        }
        // trigger change detection
        fixture.detectChanges();
        expect(spy).toHaveBeenCalled();
        expect(Number(numberNativeElement.value)).toBe(456.456);
    });
};
export const numberErrorTest = (testConfig, errorTestInformation, testData = defaultNumberTestData) => () => {
    let fixture;
    let component;
    baseSetup(testConfig);
    beforeEach(() => {
        const preparedComponents = prepareComponent(testConfig);
        fixture = preparedComponents.fixture;
        component = preparedComponents.component;
    });
    it('should display errors', () => {
        component.uischema = testData.uischema;
        const formsService = getJsonFormsService(component);
        formsService.init({
            core: {
                data: testData.data,
                schema: testData.schema,
                uischema: undefined,
            },
        });
        formsService.updateCore(Actions.updateErrors([
            {
                instancePath: '/foo',
                message: 'Hi, this is me, test error!',
                keyword: '',
                schemaPath: '',
                params: {},
            },
        ]));
        formsService.refresh();
        component.ngOnInit();
        fixture.detectChanges();
        const debugErrors = fixture.debugElement.queryAll(By.directive(errorTestInformation.errorInstance));
        expect(debugErrors.length).toBe(errorTestInformation.numberOfElements);
        expect(debugErrors[errorTestInformation.indexOfElement].nativeElement
            .textContent).toBe('Hi, this is me, test error!');
    });
};
const additionalSchema = {
    type: 'object',
    properties: {
        foo: {
            type: 'number',
            minimum: -42.42,
            maximum: 42,
            multipleOf: 3,
        },
    },
};
export const additionalTestData = {
    data: defaultData,
    schema: additionalSchema,
    uischema: defaultUischema,
};
export const numberAdditionalPropsTest = (testConfig, instance, elementToUse, testData = additionalTestData) => () => {
    let fixture;
    let numberNativeElement;
    baseSetup(testConfig);
    beforeEach(() => {
        const preparedComponents = prepareComponent(testConfig, instance, elementToUse);
        fixture = preparedComponents.fixture;
        numberNativeElement = preparedComponents.numberNativeElement;
    });
    it('should respect min,max,multipleOf', () => {
        setupMockStore(fixture, testData);
        getJsonFormsService(fixture.componentInstance).updateCore(Actions.init(testData.data, testData.schema));
        fixture.componentInstance.ngOnInit();
        fixture.detectChanges();
        // step, min and max are of type string on an input control
        expect(numberNativeElement.step).toBe('3');
        expect(numberNativeElement.min).toBe('-42.42');
        expect(numberNativeElement.max).toBe('42');
    });
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibnVtYmVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2xpYnJhcnkvbnVtYmVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQXlCQSxPQUFPLEVBQW9CLE9BQU8sRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQ2xFLE9BQU8sRUFBRSxFQUFFLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUUvQyxPQUFPLEVBQUUsT0FBTyxFQUE4QixNQUFNLGlCQUFpQixDQUFDO0FBQ3RFLE9BQU8sRUFDTCxTQUFTLEVBRVQsbUJBQW1CLEVBQ25CLGNBQWMsR0FHZixNQUFNLFFBQVEsQ0FBQztBQVNoQixNQUFNLENBQUMsTUFBTSxnQkFBZ0IsR0FBRyxDQUM5QixVQUF5QixFQUN6QixRQUFpQixFQUNqQixZQUE2QyxFQUN6QixFQUFFO0lBQ3RCLE1BQU0sT0FBTyxHQUFHLE9BQU8sQ0FBQyxlQUFlLENBQUMsVUFBVSxDQUFDLFdBQVcsQ0FBQyxDQUFDO0lBQ2hFLE1BQU0sU0FBUyxHQUFHLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQztJQUM1QyxNQUFNLE1BQU0sR0FBdUIsRUFBRSxPQUFPLEVBQUUsU0FBUyxFQUFFLENBQUM7SUFDMUQsSUFBSSxRQUFRLElBQUksWUFBWSxFQUFFO1FBQzVCLE1BQU0sYUFBYSxHQUFHLE9BQU8sQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztRQUNuRSxNQUFNLG1CQUFtQixHQUFHLFlBQVksQ0FBQyxhQUFhLENBQUMsQ0FBQztRQUN4RCxNQUFNLENBQUMsYUFBYSxHQUFHLGFBQWEsQ0FBQztRQUNyQyxNQUFNLENBQUMsbUJBQW1CLEdBQUcsbUJBQW1CLENBQUM7S0FDbEQ7SUFFRCxPQUFPLE1BQU0sQ0FBQztBQUNoQixDQUFDLENBQUM7QUFDRixNQUFNLFdBQVcsR0FBRyxFQUFFLEdBQUcsRUFBRSxPQUFPLEVBQUUsQ0FBQztBQUNyQyxNQUFN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QUFHLEVBQUU7SUFDSCxJQUFJLE9BQThCLENBQUM7SUFDbkMsSUFBSSxtQkFBd0IsQ0FBQztJQUU3QixTQUFTLENBQUMsVUFBVSxDQUFDLENBQUM7SUFFdEIsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLE1BQU0sa0JBQWtCLEdBQUcsZ0JBQWdCLENBQ3pDLFVBQVUsRUFDVixRQUFRLEVBQ1IsWUFBWSxDQUNiLENBQUM7UUFDRixPQUFPLEdBQUcsa0JBQWtCLENBQUMsT0FBTyxDQUFDO1FBQ3JDLG1CQUFtQixHQUFHLGtCQUFrQixDQUFDLG1CQUFtQixDQUFDO0lBQy9ELENBQUMsQ0FBQyxDQUFDO0lBRUgsRUFBRSxDQUFDLG1DQUFtQyxFQUFFLEdBQUcsRUFBRTtRQUMzQyxjQUFjLENBQUMsT0FBTyxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBQ2xDLG1CQUFtQixDQUFDLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLFVBQVUsQ0FDdkQsT0FBTyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FDN0MsQ0FBQztRQUNGLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUNyQyxPQUFPLENBQUMsYUFBYSxFQUFFLENBQUM7UUFFeEIsMkRBQTJEO1FBQzNELE1BQU0sQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDM0MsTUFBTSxDQUFDLG1CQUFtQixDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUMvQyxNQUFNLENBQUMsbUJBQW1CLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzdDLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAgVGhlIE1JVCBMaWNlbnNlXG4gIFxuICBDb3B5cmlnaHQgKGMpIDIwMTctMjAxOSBFY2xpcHNlU291cmNlIE11bmljaFxuICBodHRwczovL2dpdGh1Yi5jb20vZWNsaXBzZXNvdXJjZS9qc29uZm9ybXNcbiAgXG4gIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcbiAgb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgXCJTb2Z0d2FyZVwiKSwgdG8gZGVhbFxuICBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzXG4gIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGxcbiAgY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzXG4gIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XG4gIFxuICBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpblxuICBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS5cbiAgXG4gIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1JcbiAgSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXG4gIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRVxuICBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSXG4gIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXG4gIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU5cbiAgVEhFIFNPRlRXQVJFLlxuKi9cbmltcG9ydCB0eXBlIHsgRGVidWdFbGVtZW50IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBDb21wb25lbnRGaXh0dXJlLCBUZXN0QmVkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZS90ZXN0aW5nJztcbmltcG9ydCB7IEJ5IH0gZnJvbSAnQGFuZ3VsYXIvcGxhdGZvcm0tYnJvd3Nlcic7XG5pbXBvcnQgdHlwZSB7IEpzb25Gb3Jtc0NvbnRyb2wgfSBmcm9tICdAanNvbmZvcm1zL2FuZ3VsYXInO1xuaW1wb3J0IHsgQWN0aW9ucywgQ29udHJvbEVsZW1lbnQsIEpzb25TY2hlbWEgfSBmcm9tICdAanNvbmZvcm1zL2NvcmUnO1xuaW1wb3J0IHtcbiAgYmFzZVNldHVwLFxuICBFcnJvclRlc3RFeHBlY3RhdGlvbixcbiAgZ2V0SnNvbkZvcm1zU2VydmljZSxcbiAgc2V0dXBNb2NrU3RvcmUsXG4gIFRlc3RDb25maWcsXG4gIFRlc3REYXRhLFxufSBmcm9tICcuL3V0aWwnO1xuXG5pbnRlcmZhY2UgQ29tcG9uZW50UmVzdWx0PEMgZXh0ZW5kcyBKc29uRm9ybXNDb250cm9sPiB7XG4gIGZpeHR1cmU6IENvbXBvbmVudEZpeHR1cmU8YW55PjtcbiAgY29tcG9uZW50OiBDO1xuICBudW1iZXJFbGVtZW50PzogRGVidWdFbGVtZW50O1xuICBudW1iZXJOYXRpdmVFbGVtZW50PzogYW55O1xufVxuXG5leHBvcnQgY29uc3QgcHJlcGFyZUNvbXBvbmVudCA9IDxDIGV4dGVuZHMgSnNvbkZvcm1zQ29udHJvbD4oXG4gIHRlc3RDb25maWc6IFRlc3RDb25maWc8Qz4sXG4gIGluc3RhbmNlPzogc3RyaW5nLFxuICBlbGVtZW50VG9Vc2U/OiAoZWxlbWVudDogRGVidWdFbGVtZW50KSA9PiBhbnlcbik6IENvbXBvbmVudFJlc3VsdDxDPiA9PiB7XG4gIGNvbnN0IGZpeHR1cmUgPSBUZXN0QmVkLmNyZWF0ZUNvbXBvbmVudCh0ZXN0Q29uZmlnLmNvbXBvbmVudFVUKTtcbiAgY29uc3QgY29tcG9uZW50ID0gZml4dHVyZS5jb21wb25lbnRJbnN0YW5jZTtcbiAgY29uc3QgcmVzdWx0OiBDb21wb25lbnRSZXN1bHQ8Qz4gPSB7IGZpeHR1cmUsIGNvbXBvbmVudCB9O1xuICBpZiAoaW5zdGFuY2UgJiYgZWxlbWVudFRvVXNlKSB7XG4gICAgY29uc3QgbnVtYmVyRWxlbWVudCA9IGZpeHR1cmUuZGVidWdFbGVtZW50LnF1ZXJ5KEJ5LmNzcyhpbnN0YW5jZSkpO1xuICAgIGNvbnN0IG51bWJlck5hdGl2ZUVsZW1lbnQgPSBlbGVtZW50VG9Vc2UobnVtYmVyRWxlbWVudCk7XG4gICAgcmVzdWx0Lm51bWJlckVsZW1lbnQgPSBudW1iZXJFbGVtZW50O1xuICAgIHJlc3VsdC5udW1iZXJOYXRpdmVFbGVtZW50ID0gbnVtYmVyTmF0aXZlRWxlbWVudDtcbiAgfVxuXG4gIHJldHVybiByZXN1bHQ7XG59O1xuY29uc3QgZGVmYXVsdERhdGEgPSB7IGZvbzogMTIzLjEyMyB9O1xuY29uc3QgZGVmYXVsdFNjaGVtYTogSnNvblNjaGVtYSA9IHtcbiAgdHlwZTogJ29iamVjdCcsXG4gIHByb3BlcnRpZXM6IHtcbiAgICBmb286IHtcbiAgICAgIHR5cGU6ICdudW1iZXInLFxuICAgIH0sXG4gIH0sXG59O1xuY29uc3QgZGVmYXVsdFVpc2NoZW1hOiBDb250cm9sRWxlbWVudCA9IHtcbiAgdHlwZTogJ0NvbnRyb2wnLFxuICBzY29wZTogJyMvcHJvcGVydGllcy9mb28nLFxufTtcbmV4cG9ydCBjb25zdCBkZWZhdWx0TnVtYmVyVGVzdERhdGE6IFRlc3REYXRhPENvbnRyb2xFbGVtZW50PiA9IHtcbiAgZGF0YTogZGVmYXVsdERhdGEsXG4gIHNjaGVtYTogZGVmYXVsdFNjaGVtYSxcbiAgdWlzY2hlbWE6IGRlZmF1bHRVaXNjaGVtYSxcbn07XG5leHBvcnQgY29uc3QgdXBkYXRlV2l0aFNpYmxpbmdOdW1iZXJWYWx1ZSA9IDxDIGV4dGVuZHMgSnNvbkZvcm1zQ29udHJvbD4oXG4gIGZpeHR1cmU6IENvbXBvbmVudEZpeHR1cmU8Qz4sXG4gIHRlc3REYXRhOiBUZXN0RGF0YTxDb250cm9sRWxlbWVudD4sXG4gIGV4cGVjdGF0aW9uczogKCkgPT4gYW55XG4pID0+IHtcbiAgc2V0dXBNb2NrU3RvcmUoZml4dHVyZSwgdGVzdERhdGEpO1xuICBnZXRKc29uRm9ybXNTZXJ2aWNlKGZpeHR1cmUuY29tcG9uZW50SW5zdGFuY2UpLmluaXQoe1xuICAgIGNvcmU6IHtcbiAgICAgIGRhdGE6IHsgZm9vOiAxMjMuMTIzLCBiYXI6IDQ1Ni40NTYgfSxcbiAgICAgIHNjaGVtYTogdGVzdERhdGEuc2NoZW1hLFxuICAgICAgdWlzY2hlbWE6IHVuZGVmaW5lZCxcbiAgICB9LFxuICB9KTtcbiAgZml4dHVyZS5jb21wb25lbnRJbnN0YW5jZS5uZ09uSW5pdCgpO1xuICBmaXh0dXJlLmRldGVjdENoYW5nZXMoKTtcbiAgZXhwZWN0YXRpb25zKCk7XG59O1xuXG5leHBvcnQgY29uc3QgbnVtYmVyQmFzZVRlc3QgPVxuICA8QyBleHRlbmRzIEpzb25Gb3Jtc0NvbnRyb2w+KFxuICAgIHRlc3RDb25maWc6IFRlc3RDb25maWc8Qz4sXG4gICAgaW5zdGFuY2U6IHN0cmluZyxcbiAgICBlbGVtZW50VG9Vc2U6IChlbGVtZW50OiBEZWJ1Z0VsZW1lbnQpID0+IGFueSxcbiAgICB0ZXN0RGF0YTogVGVzdERhdGE8Q29udHJvbEVsZW1lbnQ+ID0gZGVmYXVsdE51bWJlclRlc3REYXRhXG4gICkgPT5cbiAgKCkgPT4ge1xuICAgIGxldCBmaXh0dXJlOiBDb21wb25lbnRGaXh0dXJlPGFueT47XG4gICAgbGV0IG51bWJlckVsZW1lbnQ6IERlYnVnRWxlbWVudDtcbiAgICBsZXQgbnVtYmVyTmF0aXZlRWxlbWVudDogYW55O1xuICAgIGxldCBjb21wb25lbnQ6IEM7XG5cbiAgICBiYXNlU2V0dXAodGVzdENvbmZpZyk7XG5cbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIGNvbnN0IHByZXBhcmVkQ29tcG9uZW50cyA9IHByZXBhcmVDb21wb25lbnQoXG4gICAgICAgIHRlc3RDb25maWcsXG4gICAgICAgIGluc3RhbmNlLFxuICAgICAgICBlbGVtZW50VG9Vc2VcbiAgICAgICk7XG4gICAgICBmaXh0dXJlID0gcHJlcGFyZWRDb21wb25lbnRzLmZpeHR1cmU7XG4gICAgICBudW1iZXJOYXRpdmVFbGVtZW50ID0gcHJlcGFyZWRDb21wb25lbnRzLm51bWJlck5hdGl2ZUVsZW1lbnQ7XG4gICAgICBudW1iZXJFbGVtZW50ID0gcHJlcGFyZWRDb21wb25lbnRzLm51bWJlckVsZW1lbnQ7XG4gICAgICBjb21wb25lbnQgPSBwcmVwYXJlZENvbXBvbmVudHMuY29tcG9uZW50O1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZW5kZXIgZmxvYXRzJywgKCkgPT4ge1xuICAgICAgY29tcG9uZW50LnVpc2NoZW1hID0gdGVzdERhdGEudWlzY2hlbWE7XG4gICAgICBnZXRKc29uRm9ybXNTZXJ2aWNlKGNvbXBvbmVudCkuaW5pdCh7IGNvcmU6IHRlc3REYXRhIH0pO1xuICAgICAgZ2V0SnNvbkZvcm1zU2VydmljZShjb21wb25lbnQpLnVwZGF0ZUNvcmUoXG4gICAgICAgIEFjdGlvbnMuaW5pdCh0ZXN0RGF0YS5kYXRhLCB0ZXN0RGF0YS5zY2hlbWEpXG4gICAgICApO1xuICAgICAgY29tcG9uZW50Lm5nT25Jbml0KCk7XG4gICAgICBmaXh0dXJlLmRldGVjdENoYW5nZXMoKTtcbiAgICAgIGV4cGVjdChjb21wb25lbnQuZGF0YSkudG9CZSgxMjMuMTIzKTtcbiAgICAgIGV4cGVjdChudW1iZXJOYXRpdmVFbGVtZW50LnZhbHVlKS50b0JlKCcxMjMuMTIzJyk7XG4gICAgICAvLyBzdGVwIGlzIG9mIHR5cGUgc3RyaW5nXG4gICAgICBleHBlY3QobnVtYmVyTmF0aXZlRWxlbWVudC5zdGVwKS50b0JlKCcwLjEnKTtcbiAgICAgIGV4cGVjdChudW1iZXJOYXRpdmVFbGVtZW50LmRpc2FibGVkKS50b0JlKGZhbHNlKTtcbiAgICAgIC8vIHRoZSBjb21wb25lbnQgaXMgd3JhcHBlZCBpbiBhIGRpdlxuICAgICAgZXhwZWN0KGZpeHR1cmUubmF0aXZlRWxlbWVudC5jaGlsZHJlblswXS5zdHlsZS5kaXNwbGF5KS5ub3QudG9CZSgnbm9uZScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZW5kZXIgaW50ZWdlcnMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBzdGF0ZSA9IHtcbiAgICAgICAgZGF0YTogeyBmb286IDEyMyB9LFxuICAgICAgICBzY2hlbWE6IHtcbiAgICAgICAgICB0eXBlOiAnb2JqZWN0JyxcbiAgICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICBmb286IHsgdHlwZTogJ2ludGVnZXInIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgdWlzY2hlbWE6IHRlc3REYXRhLnVpc2NoZW1hLFxuICAgICAgfTtcbiAgICAgIGNvbXBvbmVudC51aXNjaGVtYSA9IHRlc3REYXRhLnVpc2NoZW1hO1xuICAgICAgZ2V0SnNvbkZvcm1zU2VydmljZShjb21wb25lbnQpLmluaXQoeyBjb3JlOiBzdGF0ZSB9KTtcbiAgICAgIGdldEpzb25Gb3Jtc1NlcnZpY2UoY29tcG9uZW50KS51cGRhdGVDb3JlKFxuICAgICAgICBBY3Rpb25zLmluaXQoc3RhdGUuZGF0YSwgc3RhdGUuc2NoZW1hKVxuICAgICAgKTtcbiAgICAgIGNvbXBvbmVudC5uZ09uSW5pdCgpO1xuICAgICAgZml4dHVyZS5kZXRlY3RDaGFuZ2VzKCk7XG5cbiAgICAgIGV4cGVjdChjb21wb25lbnQuZGF0YSkudG9CZSgxMjMpO1xuICAgICAgZXhwZWN0KG51bWJlck5hdGl2ZUVsZW1lbnQudmFsdWUpLnRvQmUoJzEyMycpO1xuICAgICAgLy8gc3RlcCBpcyBvZiB0eXBlIHN0cmluZ1xuICAgICAgZXhwZWN0KG51bWJlck5hdGl2ZUVsZW1lbnQuc3RlcCkudG9CZSgnMScpO1xuICAgICAgZXhwZWN0KG51bWJlck5hdGl2ZUVsZW1lbnQuZGlzYWJsZWQpLnRvQmUoZmFsc2UpO1xuICAgICAgLy8gdGhlIGNvbXBvbmVudCBpcyB3cmFwcGVkIGluIGEgZGl2XG4gICAgICBleHBlY3QoZml4dHVyZS5uYXRpdmVFbGVtZW50LmNoaWxkcmVuWzBdLnN0eWxlLmRpc3BsYXkpLm5vdC50b0JlKCdub25lJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHN1cHBvcnQgdXBkYXRpbmcgdGhlIHN0YXRlJywgKCkgPT4ge1xuICAgICAgY29tcG9uZW50LnVpc2NoZW1hID0gdGVzdERhdGEudWlzY2hlbWE7XG4gICAgICBnZXRKc29uRm9ybXNTZXJ2aWNlKGNvbXBvbmVudCkuaW5pdCh7IGNvcmU6IHRlc3REYXRhIH0pO1xuICAgICAgZ2V0SnNvbkZvcm1zU2VydmljZShjb21wb25lbnQpLnVwZGF0ZUNvcmUoXG4gICAgICAgIEFjdGlvbnMuaW5pdCh0ZXN0RGF0YS5kYXRhLCB0ZXN0RGF0YS5zY2hlbWEpXG4gICAgICApO1xuICAgICAgY29tcG9uZW50Lm5nT25Jbml0KCk7XG4gICAgICBmaXh0dXJlLmRldGVjdENoYW5nZXMoKTtcbiAgICAgIGdldEpzb25Gb3Jtc1NlcnZpY2UoZml4dHVyZS5jb21wb25lbnRJbnN0YW5jZSkudXBkYXRlQ29yZShcbiAgICAgICAgQWN0aW9ucy51cGRhdGUoJ2ZvbycsICgpID0+IDQ1Ni40NTYpXG4gICAgICApO1xuICAgICAgZml4dHVyZS5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgICBleHBlY3QoY29tcG9uZW50LmRhdGEpLnRvQmUoNDU2LjQ1Nik7XG4gICAgICBleHBlY3QoTnVtYmVyKG51bWJlck5hdGl2ZUVsZW1lbnQudmFsdWUpKS50b0JlKDQ1Ni40NTYpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB1cGRhdGUgd2l0aCB1bmRlZmluZWQgdmFsdWUnLCAoKSA9PiB7XG4gICAgICBjb21wb25lbnQudWlzY2hlbWEgPSB0ZXN0RGF0YS51aXNjaGVtYTtcbiAgICAgIGdldEpzb25Gb3Jtc1NlcnZpY2UoY29tcG9uZW50KS5pbml0KHsgY29yZTogdGVzdERhdGEgfSk7XG4gICAgICBnZXRKc29uRm9ybXNTZXJ2aWNlKGNvbXBvbmVudCkudXBkYXRlQ29yZShcbiAgICAgICAgQWN0aW9ucy5pbml0KHRlc3REYXRhLmRhdGEsIHRlc3REYXRhLnNjaGVtYSlcbiAgICAgICk7XG4gICAgICBjb21wb25lbnQubmdPbkluaXQoKTtcbiAgICAgIGZpeHR1cmUuZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgZ2V0SnNvbkZvcm1zU2VydmljZShmaXh0dXJlLmNvbXBvbmVudEluc3RhbmNlKS51cGRhdGVDb3JlKFxuICAgICAgICBBY3Rpb25zLnVwZGF0ZSgnZm9vJywgKCkgPT4gdW5kZWZpbmVkKVxuICAgICAgKTtcbiAgICAgIGZpeHR1cmUuZGV0ZWN0Q2hhbmdlcygpO1xuXG4gICAgICBleHBlY3QoY29tcG9uZW50LmRhdGEpLnRvQmUodW5kZWZpbmVkKTtcbiAgICAgIGV4cGVjdChudW1iZXJOYXRpdmVFbGVtZW50LnZhbHVlKS50b0JlKCcnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdXBkYXRlIHdpdGggbnVsbCB2YWx1ZScsICgpID0+IHtcbiAgICAgIGNvbXBvbmVudC51aXNjaGVtYSA9IHRlc3REYXRhLnVpc2NoZW1hO1xuICAgICAgZ2V0SnNvbkZvcm1zU2VydmljZShjb21wb25lbnQpLmluaXQoeyBjb3JlOiB0ZXN0RGF0YSB9KTtcbiAgICAgIGdldEpzb25Gb3Jtc1NlcnZpY2UoY29tcG9uZW50KS51cGRhdGVDb3JlKFxuICAgICAgICBBY3Rpb25zLmluaXQodGVzdERhdGEuZGF0YSwgdGVzdERhdGEuc2NoZW1hKVxuICAgICAgKTtcbiAgICAgIGNvbXBvbmVudC5uZ09uSW5pdCgpO1xuICAgICAgZml4dHVyZS5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgICBnZXRKc29uRm9ybXNTZXJ2aWNlKGZpeHR1cmUuY29tcG9uZW50SW5zdGFuY2UpLnVwZGF0ZUNvcmUoXG4gICAgICAgIEFjdGlvbnMudXBkYXRlKCdmb28nLCAoKSA9PiBudWxsKVxuICAgICAgKTtcbiAgICAgIGZpeHR1cmUuZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgZXhwZWN0KGNvbXBvbmVudC5kYXRhKS50b0JlKG51bGwpO1xuICAgICAgZXhwZWN0KG51bWJlck5hdGl2ZUVsZW1lbnQudmFsdWUpLnRvQmUoJycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBub3QgdXBkYXRlIHdpdGggd3JvbmcgcmVmJywgKCkgPT4ge1xuICAgICAgY29tcG9uZW50LnVpc2NoZW1hID0gdGVzdERhdGEudWlzY2hlbWE7XG4gICAgICBnZXRKc29uRm9ybXNTZXJ2aWNlKGNvbXBvbmVudCkuaW5pdCh7IGNvcmU6IHRlc3REYXRhIH0pO1xuICAgICAgZ2V0SnNvbkZvcm1zU2VydmljZShjb21wb25lbnQpLnVwZGF0ZUNvcmUoXG4gICAgICAgIEFjdGlvbnMuaW5pdCh0ZXN0RGF0YS5kYXRhLCB0ZXN0RGF0YS5zY2hlbWEpXG4gICAgICApO1xuICAgICAgY29tcG9uZW50Lm5nT25Jbml0KCk7XG4gICAgICBmaXh0dXJlLmRldGVjdENoYW5nZXMoKTtcbiAgICAgIGdldEpzb25Gb3Jtc1NlcnZpY2UoZml4dHVyZS5jb21wb25lbnRJbnN0YW5jZSkudXBkYXRlQ29yZShcbiAgICAgICAgQWN0aW9ucy51cGRhdGUoJ2JhcicsICgpID0+IDQ1Ni40NTYpXG4gICAgICApO1xuICAgICAgZml4dHVyZS5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgICBleHBlY3QoY29tcG9uZW50LmRhdGEpLnRvQmUoMTIzLjEyMyk7XG4gICAgICBleHBlY3QoTnVtYmVyKG51bWJlck5hdGl2ZUVsZW1lbnQudmFsdWUpKS50b0JlKDEyMy4xMjMpO1xuICAgIH0pO1xuXG4gICAgLy8gc3RvcmUgbmVlZGVkIGFzIHdlIGV2YWx1YXRlIHRoZSBjYWxjdWxhdGVkIGVuYWJsZWQgdmFsdWUgdG8gZGlzYWJsZS9lbmFibGUgdGhlIGNvbnRyb2xcbiAgICBpdCgnY2FuIGJlIGRpc2FibGVkJywgKCkgPT4ge1xuICAgICAgY29tcG9uZW50LnVpc2NoZW1hID0gdGVzdERhdGEudWlzY2hlbWE7XG4gICAgICBjb21wb25lbnQuZGlzYWJsZWQgPSB0cnVlO1xuXG4gICAgICBnZXRKc29uRm9ybXNTZXJ2aWNlKGNvbXBvbmVudCkuaW5pdCh7XG4gICAgICAgIGNvcmU6IHtcbiAgICAgICAgICBkYXRhOiB0ZXN0RGF0YS5kYXRhLFxuICAgICAgICAgIHNjaGVtYTogdGVzdERhdGEuc2NoZW1hLFxuICAgICAgICAgIHVpc2NoZW1hOiB0ZXN0RGF0YS51aXNjaGVtYSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgICAgY29tcG9uZW50Lm5nT25Jbml0KCk7XG4gICAgICBmaXh0dXJlLmRldGVjdENoYW5nZXMoKTtcbiAgICAgIGV4cGVjdChudW1iZXJOYXRpdmVFbGVtZW50LmRpc2FibGVkKS50b0JlKHRydWUpO1xuICAgIH0pO1xuICAgIC8vIHN0b3JlIG5lZWRlZCBhcyB3ZSBldmFsdWF0ZSB0aGUgY2FsY3VsYXRlZCBlbmFibGVkIHZhbHVlIHRvIGRpc2FibGUvZW5hYmxlIHRoZSBjb250cm9sXG4gICAgaXQoJ2NhbiBiZSBoaWRkZW4nLCAoKSA9PiB7XG4gICAgICBjb21wb25lbnQudWlzY2hlbWEgPSB0ZXN0RGF0YS51aXNjaGVtYTtcbiAgICAgIGNvbXBvbmVudC52aXNpYmxlID0gZmFsc2U7XG5cbiAgICAgIGdldEpzb25Gb3Jtc1NlcnZpY2UoY29tcG9uZW50KS5pbml0KHtcbiAgICAgICAgY29yZToge1xuICAgICAgICAgIGRhdGE6IHRlc3REYXRhLmRhdGEsXG4gICAgICAgICAgc2NoZW1hOiB0ZXN0RGF0YS5zY2hlbWEsXG4gICAgICAgICAgdWlzY2hlbWE6IHRlc3REYXRhLnVpc2NoZW1hLFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgICBjb21wb25lbnQubmdPbkluaXQoKTtcbiAgICAgIGZpeHR1cmUuZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgY29uc3QgaGFzRGlzcGxheU5vbmUgPVxuICAgICAgICAnbm9uZScgPT09IGZpeHR1cmUubmF0aXZlRWxlbWVudC5jaGlsZHJlblswXS5zdHlsZS5kaXNwbGF5O1xuICAgICAgY29uc3QgaGFzSGlkZGVuID0gZml4dHVyZS5uYXRpdmVFbGVtZW50LmNoaWxkcmVuWzBdLmhpZGRlbjtcbiAgICAgIGV4cGVjdChoYXNEaXNwbGF5Tm9uZSB8fCBoYXNIaWRkZW4pLnRvQmVUcnV0aHkoKTtcbiAgICB9KTtcblxuICAgIGl0KCdpZCBzaG91bGQgYmUgcHJlc2VudCBpbiBvdXRwdXQnLCAoKSA9PiB7XG4gICAgICBjb21wb25lbnQudWlzY2hlbWEgPSB0ZXN0RGF0YS51aXNjaGVtYTtcbiAgICAgIGNvbXBvbmVudC5pZCA9ICdteUlkJztcbiAgICAgIGdldEpzb25Gb3Jtc1NlcnZpY2UoY29tcG9uZW50KS5pbml0KHtcbiAgICAgICAgY29yZToge1xuICAgICAgICAgIGRhdGE6IHRlc3REYXRhLmRhdGEsXG4gICAgICAgICAgc2NoZW1hOiB0ZXN0RGF0YS5zY2hlbWEsXG4gICAgICAgICAgdWlzY2hlbWE6IHRlc3REYXRhLnVpc2NoZW1hLFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgICBjb21wb25lbnQubmdPbkluaXQoKTtcbiAgICAgIGZpeHR1cmUuZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgZXhwZWN0KG51bWJlckVsZW1lbnQubmF0aXZlRWxlbWVudC5pZCkudG9CZSgnbXlJZCcpO1xuICAgIH0pO1xuICB9O1xuZXhwb3J0IGNvbnN0IG51bWJlcklucHV0RXZlbnRUZXN0ID1cbiAgPEMgZXh0ZW5kcyBKc29uRm9ybXNDb250cm9sPihcbiAgICB0ZXN0Q29uZmlnOiBUZXN0Q29uZmlnPEM+LFxuICAgIGluc3RhbmNlOiBzdHJpbmcsXG4gICAgZWxlbWVudFRvVXNlOiAoZWxlbWVudDogRGVidWdFbGVtZW50KSA9PiBhbnksXG4gICAgdGVzdERhdGE6IFRlc3REYXRhPENvbnRyb2xFbGVtZW50PiA9IGRlZmF1bHROdW1iZXJUZXN0RGF0YVxuICApID0+XG4gICgpID0+IHtcbiAgICBsZXQgZml4dHVyZTogQ29tcG9uZW50Rml4dHVyZTxhbnk+O1xuICAgIGxldCBudW1iZXJOYXRpdmVFbGVtZW50OiBhbnk7XG4gICAgbGV0IGNvbXBvbmVudDogQztcblxuICAgIGJhc2VTZXR1cCh0ZXN0Q29uZmlnKTtcblxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgY29uc3QgcHJlcGFyZWRDb21wb25lbnRzID0gcHJlcGFyZUNvbXBvbmVudChcbiAgICAgICAgdGVzdENvbmZpZyxcbiAgICAgICAgaW5zdGFuY2UsXG4gICAgICAgIGVsZW1lbnRUb1VzZVxuICAgICAgKTtcbiAgICAgIGZpeHR1cmUgPSBwcmVwYXJlZENvbXBvbmVudHMuZml4dHVyZTtcbiAgICAgIG51bWJlck5hdGl2ZUVsZW1lbnQgPSBwcmVwYXJlZENvbXBvbmVudHMubnVtYmVyTmF0aXZlRWxlbWVudDtcbiAgICAgIGNvbXBvbmVudCA9IHByZXBhcmVkQ29tcG9uZW50cy5jb21wb25lbnQ7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHVwZGF0ZSB2aWEgaW5wdXQgZXZlbnQnLCAoKSA9PiB7XG4gICAgICBjb21wb25lbnQudWlzY2hlbWEgPSB0ZXN0RGF0YS51aXNjaGVtYSBhcyBDb250cm9sRWxlbWVudDtcblxuICAgICAgZ2V0SnNvbkZvcm1zU2VydmljZShjb21wb25lbnQpLmluaXQoe1xuICAgICAgICBjb3JlOiB7XG4gICAgICAgICAgZGF0YTogdGVzdERhdGEuZGF0YSxcbiAgICAgICAgICBzY2hlbWE6IHRlc3REYXRhLnNjaGVtYSxcbiAgICAgICAgICB1aXNjaGVtYTogdW5kZWZpbmVkLFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgICBmaXh0dXJlLmRldGVjdENoYW5nZXMoKTtcbiAgICAgIGNvbXBvbmVudC5uZ09uSW5pdCgpO1xuXG4gICAgICBjb25zdCBzcHkgPSBzcHlPbihjb21wb25lbnQsICdvbkNoYW5nZScpO1xuICAgICAgbnVtYmVyTmF0aXZlRWxlbWVudC52YWx1ZSA9IDQ1Ni40NTY7XG4gICAgICBpZiAobnVtYmVyTmF0aXZlRWxlbWVudC5kaXNwYXRjaEV2ZW50KSB7XG4gICAgICAgIG51bWJlck5hdGl2ZUVsZW1lbnQuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoJ2lucHV0JykpO1xuICAgICAgfVxuICAgICAgLy8gdHJpZ2dlciBjaGFuZ2UgZGV0ZWN0aW9uXG4gICAgICBmaXh0dXJlLmRldGVjdENoYW5nZXMoKTtcbiAgICAgIGV4cGVjdChzcHkpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIGV4cGVjdChOdW1iZXIobnVtYmVyTmF0aXZlRWxlbWVudC52YWx1ZSkpLnRvQmUoNDU2LjQ1Nik7XG4gICAgfSk7XG4gIH07XG5leHBvcnQgY29uc3QgbnVtYmVyRXJyb3JUZXN0ID1cbiAgPEMgZXh0ZW5kcyBKc29uRm9ybXNDb250cm9sPihcbiAgICB0ZXN0Q29uZmlnOiBUZXN0Q29uZmlnPEM+LFxuICAgIGVycm9yVGVzdEluZm9ybWF0aW9uOiBFcnJvclRlc3RFeHBlY3RhdGlvbixcbiAgICB0ZXN0RGF0YTogVGVzdERhdGE8Q29udHJvbEVsZW1lbnQ+ID0gZGVmYXVsdE51bWJlclRlc3REYXRhXG4gICkgPT5cbiAgKCkgPT4ge1xuICAgIGxldCBmaXh0dXJlOiBDb21wb25lbnRGaXh0dXJlPGFueT47XG4gICAgbGV0IGNvbXBvbmVudDogQztcblxuICAgIGJhc2VTZXR1cCh0ZXN0Q29uZmlnKTtcblxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgY29uc3QgcHJlcGFyZWRDb21wb25lbnRzID0gcHJlcGFyZUNvbXBvbmVudCh0ZXN0Q29uZmlnKTtcbiAgICAgIGZpeHR1cmUgPSBwcmVwYXJlZENvbXBvbmVudHMuZml4dHVyZTtcbiAgICAgIGNvbXBvbmVudCA9IHByZXBhcmVkQ29tcG9uZW50cy5jb21wb25lbnQ7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGRpc3BsYXkgZXJyb3JzJywgKCkgPT4ge1xuICAgICAgY29tcG9uZW50LnVpc2NoZW1hID0gdGVzdERhdGEudWlzY2hlbWE7XG5cbiAgICAgIGNvbnN0IGZvcm1zU2VydmljZSA9IGdldEpzb25Gb3Jtc1NlcnZpY2UoY29tcG9uZW50KTtcbiAgICAgIGZvcm1zU2VydmljZS5pbml0KHtcbiAgICAgICAgY29yZToge1xuICAgICAgICAgIGRhdGE6IHRlc3REYXRhLmRhdGEsXG4gICAgICAgICAgc2NoZW1hOiB0ZXN0RGF0YS5zY2hlbWEsXG4gICAgICAgICAgdWlzY2hlbWE6IHVuZGVmaW5lZCxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgICAgZm9ybXNTZXJ2aWNlLnVwZGF0ZUNvcmUoXG4gICAgICAgIEFjdGlvbnMudXBkYXRlRXJyb3JzKFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBpbnN0YW5jZVBhdGg6ICcvZm9vJyxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdIaSwgdGhpcyBpcyBtZSwgdGVzdCBlcnJvciEnLFxuICAgICAgICAgICAga2V5d29yZDogJycsXG4gICAgICAgICAgICBzY2hlbWFQYXRoOiAnJyxcbiAgICAgICAgICAgIHBhcmFtczoge30sXG4gICAgICAgICAgfSxcbiAgICAgICAgXSlcbiAgICAgICk7XG4gICAgICBmb3Jtc1NlcnZpY2UucmVmcmVzaCgpO1xuICAgICAgY29tcG9uZW50Lm5nT25Jbml0KCk7XG4gICAgICBmaXh0dXJlLmRldGVjdENoYW5nZXMoKTtcbiAgICAgIGNvbnN0IGRlYnVnRXJyb3JzOiBEZWJ1Z0VsZW1lbnRbXSA9IGZpeHR1cmUuZGVidWdFbGVtZW50LnF1ZXJ5QWxsKFxuICAgICAgICBCeS5kaXJlY3RpdmUoZXJyb3JUZXN0SW5mb3JtYXRpb24uZXJyb3JJbnN0YW5jZSlcbiAgICAgICk7XG4gICAgICBleHBlY3QoZGVidWdFcnJvcnMubGVuZ3RoKS50b0JlKGVycm9yVGVzdEluZm9ybWF0aW9uLm51bWJlck9mRWxlbWVudHMpO1xuICAgICAgZXhwZWN0KFxuICAgICAgICBkZWJ1Z0Vycm9yc1tlcnJvclRlc3RJbmZvcm1hdGlvbi5pbmRleE9mRWxlbWVudF0ubmF0aXZlRWxlbWVudFxuICAgICAgICAgIC50ZXh0Q29udGVudFxuICAgICAgKS50b0JlKCdIaSwgdGhpcyBpcyBtZSwgdGVzdCBlcnJvciEnKTtcbiAgICB9KTtcbiAgfTtcblxuY29uc3QgYWRkaXRpb25hbFNjaGVtYTogSnNvblNjaGVtYSA9IHtcbiAgdHlwZTogJ29iamVjdCcsXG4gIHByb3BlcnRpZXM6IHtcbiAgICBmb286IHtcbiAgICAgIHR5cGU6ICdudW1iZXInLFxuICAgICAgbWluaW11bTogLTQyLjQyLFxuICAgICAgbWF4aW11bTogNDIsXG4gICAgICBtdWx0aXBsZU9mOiAzLFxuICAgIH0sXG4gIH0sXG59O1xuZXhwb3J0IGNvbnN0IGFkZGl0aW9uYWxUZXN0RGF0YTogVGVzdERhdGE8Q29udHJvbEVsZW1lbnQ+ID0ge1xuICBkYXRhOiBkZWZhdWx0RGF0YSxcbiAgc2NoZW1hOiBhZGRpdGlvbmFsU2NoZW1hLFxuICB1aXNjaGVtYTogZGVmYXVsdFVpc2NoZW1hLFxufTtcblxuZXhwb3J0IGNvbnN0IG51bWJlckFkZGl0aW9uYWxQcm9wc1Rlc3QgPVxuICA8QyBleHRlbmRzIEpzb25Gb3Jtc0NvbnRyb2w+KFxuICAgIHRlc3RDb25maWc6IFRlc3RDb25maWc8Qz4sXG4gICAgaW5zdGFuY2U6IHN0cmluZyxcbiAgICBlbGVtZW50VG9Vc2U6IChlbGVtZW50OiBEZWJ1Z0VsZW1lbnQpID0+IGFueSxcbiAgICB0ZXN0RGF0YTogVGVzdERhdGE8Q29udHJvbEVsZW1lbnQ+ID0gYWRkaXRpb25hbFRlc3REYXRhXG4gICkgPT5cbiAgKCkgPT4ge1xuICAgIGxldCBmaXh0dXJlOiBDb21wb25lbnRGaXh0dXJlPGFueT47XG4gICAgbGV0IG51bWJlck5hdGl2ZUVsZW1lbnQ6IGFueTtcblxuICAgIGJhc2VTZXR1cCh0ZXN0Q29uZmlnKTtcblxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgY29uc3QgcHJlcGFyZWRDb21wb25lbnRzID0gcHJlcGFyZUNvbXBvbmVudChcbiAgICAgICAgdGVzdENvbmZpZyxcbiAgICAgICAgaW5zdGFuY2UsXG4gICAgICAgIGVsZW1lbnRUb1VzZVxuICAgICAgKTtcbiAgICAgIGZpeHR1cmUgPSBwcmVwYXJlZENvbXBvbmVudHMuZml4dHVyZTtcbiAgICAgIG51bWJlck5hdGl2ZUVsZW1lbnQgPSBwcmVwYXJlZENvbXBvbmVudHMubnVtYmVyTmF0aXZlRWxlbWVudDtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVzcGVjdCBtaW4sbWF4LG11bHRpcGxlT2YnLCAoKSA9PiB7XG4gICAgICBzZXR1cE1vY2tTdG9yZShmaXh0dXJlLCB0ZXN0RGF0YSk7XG4gICAgICBnZXRKc29uRm9ybXNTZXJ2aWNlKGZpeHR1cmUuY29tcG9uZW50SW5zdGFuY2UpLnVwZGF0ZUNvcmUoXG4gICAgICAgIEFjdGlvbnMuaW5pdCh0ZXN0RGF0YS5kYXRhLCB0ZXN0RGF0YS5zY2hlbWEpXG4gICAgICApO1xuICAgICAgZml4dHVyZS5jb21wb25lbnRJbnN0YW5jZS5uZ09uSW5pdCgpO1xuICAgICAgZml4dHVyZS5kZXRlY3RDaGFuZ2VzKCk7XG5cbiAgICAgIC8vIHN0ZXAsIG1pbiBhbmQgbWF4IGFyZSBvZiB0eXBlIHN0cmluZyBvbiBhbiBpbnB1dCBjb250cm9sXG4gICAgICBleHBlY3QobnVtYmVyTmF0aXZlRWxlbWVudC5zdGVwKS50b0JlKCczJyk7XG4gICAgICBleHBlY3QobnVtYmVyTmF0aXZlRWxlbWVudC5taW4pLnRvQmUoJy00Mi40MicpO1xuICAgICAgZXhwZWN0KG51bWJlck5hdGl2ZUVsZW1lbnQubWF4KS50b0JlKCc0MicpO1xuICAgIH0pO1xuICB9O1xuIl19