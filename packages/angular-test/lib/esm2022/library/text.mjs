import { TestBed } from '@angular/core/testing';
import { By } from '@angular/platform-browser';
import { Actions } from '@jsonforms/core';
import { baseSetup, getJsonFormsService, } from './util';
const prepareComponent = (testConfig, instance, elementToUse) => {
    const fixture = TestBed.createComponent(testConfig.componentUT);
    const component = fixture.componentInstance;
    const result = { fixture, component };
    if (instance && elementToUse) {
        const textElement = fixture.debugElement.query(By.css(instance));
        const textNativeElement = elementToUse(textElement);
        result.textElement = textElement;
        result.textNativeElement = textNativeElement;
    }
    return result;
};
const defaultData = { foo: 'foo' };
const defaultSchema = {
    type: 'object',
    properties: {
        foo: {
            type: 'string',
        },
    },
};
const defaultUischema = {
    type: 'Control',
    scope: '#/properties/foo',
};
export const defaultTextTestData = {
    data: defaultData,
    schema: defaultSchema,
    uischema: defaultUischema,
};
export const textBaseTest = (testConfig, instance, elementToUse, testData = defaultTextTestData) => () => {
    let fixture;
    let textElement;
    let textNativeElement;
    let component;
    baseSetup(testConfig);
    beforeEach(() => {
        const preparedComponents = prepareComponent(testConfig, instance, elementToUse);
        fixture = preparedComponents.fixture;
        textNativeElement = preparedComponents.textNativeElement;
        textElement = preparedComponents.textElement;
        component = preparedComponents.component;
    });
    it('should render', () => {
        component.uischema = testData.uischema;
        getJsonFormsService(component).init({
            core: {
                data: testData.data,
                schema: testData.schema,
                uischema: testData.uischema,
            },
        });
        component.ngOnInit();
        fixture.detectChanges();
        expect(component.data).toBe('foo');
        expect(textNativeElement.value).toBe('foo');
        expect(textNativeElement.disabled).toBe(false);
        // the component is wrapped in a div
        const hasDisplayNone = 'none' === fixture.nativeElement.children[0].style.display;
        const hasHidden = fixture.nativeElement.children[0].hidden;
        expect(!hasDisplayNone && !hasHidden).toBeTruthy();
    });
    it('should support updating the state', () => {
        component.uischema = testData.uischema;
        getJsonFormsService(component).init({
            core: {
                data: testData.data,
                schema: testData.schema,
                uischema: testData.uischema,
            },
        });
        component.ngOnInit();
        fixture.detectChanges();
        getJsonFormsService(component).updateCore(Actions.update('foo', () => 'bar'));
        fixture.detectChanges();
        expect(component.data).toBe('bar');
        expect(textNativeElement.value).toBe('bar');
    });
    it('should update with undefined value', () => {
        component.uischema = testData.uischema;
        getJsonFormsService(component).init({
            core: {
                data: testData.data,
                schema: testData.schema,
                uischema: testData.uischema,
            },
        });
        component.ngOnInit();
        fixture.detectChanges();
        getJsonFormsService(component).updateCore(Actions.update('foo', () => undefined));
        fixture.detectChanges();
        expect(component.data).toBe(undefined);
        expect(textNativeElement.value).toBe('');
    });
    it('should update with null value', () => {
        component.uischema = testData.uischema;
        getJsonFormsService(component).init({
            core: {
                data: testData.data,
                schema: testData.schema,
                uischema: testData.uischema,
            },
        });
        component.ngOnInit();
        fixture.detectChanges();
        getJsonFormsService(component).updateCore(Actions.update('foo', () => null));
        fixture.detectChanges();
        expect(component.data).toBe(null);
        expect(textNativeElement.value).toBe('');
    });
    it('should not update with wrong ref', () => {
        component.uischema = testData.uischema;
        getJsonFormsService(component).init({
            core: {
                data: testData.data,
                schema: testData.schema,
                uischema: testData.uischema,
            },
        });
        component.ngOnInit();
        fixture.detectChanges();
        getJsonFormsService(component).updateCore(Actions.update('foo', () => 'foo'));
        getJsonFormsService(component).updateCore(Actions.update('bar', () => 'bar'));
        fixture.detectChanges();
        expect(component.data).toBe('foo');
        expect(textNativeElement.value).toBe('foo');
    });
    // store needed as we evaluate the calculated enabled value to disable/enable the control
    it('can be disabled', () => {
        component.uischema = testData.uischema;
        component.disabled = true;
        getJsonFormsService(component).init({
            core: {
                data: testData.data,
                schema: testData.schema,
                uischema: testData.uischema,
            },
        });
        component.ngOnInit();
        fixture.detectChanges();
        expect(textNativeElement.disabled).toBe(true);
    });
    it('can be hidden', () => {
        component.uischema = testData.uischema;
        component.visible = false;
        getJsonFormsService(component).init({
            core: {
                data: testData.data,
                schema: testData.schema,
                uischema: testData.uischema,
            },
        });
        component.ngOnInit();
        fixture.detectChanges();
        const hasDisplayNone = 'none' === fixture.nativeElement.children[0].style.display;
        const hasHidden = fixture.nativeElement.children[0].hidden;
        expect(hasDisplayNone || hasHidden).toBeTruthy();
    });
    it('id should be present in output', () => {
        component.uischema = testData.uischema;
        component.id = 'myId';
        getJsonFormsService(component).init({
            core: {
                data: testData.data,
                schema: testData.schema,
                uischema: testData.uischema,
            },
        });
        component.ngOnInit();
        fixture.detectChanges();
        expect(textElement.nativeElement.id).toBe('myId');
    });
};
export const textInputEventTest = (testConfig, instance, elementToUse, testData = defaultTextTestData) => () => {
    let fixture;
    let textNativeElement;
    let component;
    baseSetup(testConfig);
    beforeEach(() => {
        const preparedComponents = prepareComponent(testConfig, instance, elementToUse);
        fixture = preparedComponents.fixture;
        textNativeElement = preparedComponents.textNativeElement;
        component = preparedComponents.component;
    });
    it('should update via input event', () => {
        component.uischema = testData.uischema;
        getJsonFormsService(component).init({
            core: {
                data: testData.data,
                schema: testData.schema,
                uischema: testData.uischema,
            },
        });
        component.ngOnInit();
        fixture.detectChanges();
        const spy = spyOn(component, 'onChange');
        textNativeElement.value = 'bar';
        if (textNativeElement.dispatchEvent) {
            textNativeElement.dispatchEvent(new Event('input'));
        }
        // trigger change detection
        fixture.detectChanges();
        expect(spy).toHaveBeenCalled();
        expect(textNativeElement.value).toBe('bar');
    });
};
export const textErrorTest = (testConfig, errorTestInformation, testData = defaultTextTestData) => () => {
    let fixture;
    let component;
    baseSetup(testConfig);
    beforeEach(() => {
        const preparedComponents = prepareComponent(testConfig);
        fixture = preparedComponents.fixture;
        component = preparedComponents.component;
    });
    it('should display errors', () => {
        component.uischema = testData.uischema;
        const formsService = getJsonFormsService(component);
        formsService.init({
            core: {
                data: testData.data,
                schema: testData.schema,
                uischema: undefined,
            },
        });
        formsService.updateCore(Actions.updateErrors([
            {
                instancePath: '/foo',
                message: 'Hi, this is me, test error!',
                keyword: '',
                schemaPath: '',
                params: {},
            },
        ]));
        formsService.refresh();
        component.ngOnInit();
        fixture.detectChanges();
        const debugErrors = fixture.debugElement.queryAll(By.directive(errorTestInformation.errorInstance));
        expect(debugErrors.length).toBe(errorTestInformation.numberOfElements);
        expect(debugErrors[errorTestInformation.indexOfElement].nativeElement
            .textContent).toBe('Hi, this is me, test error!');
    });
};
export const textTypeTest = (testConfig, instance, elementToUse, testData = defaultTextTestData) => () => {
    let fixture;
    let component;
    let textNativeElement;
    baseSetup(testConfig);
    beforeEach(() => {
        const preparedComponents = prepareComponent(testConfig, instance, elementToUse);
        fixture = preparedComponents.fixture;
        component = preparedComponents.component;
        textNativeElement = preparedComponents.textNativeElement;
    });
    it('should show password independent of schema', () => {
        const uischema = JSON.parse(JSON.stringify(testData.uischema));
        uischema.options = { format: 'password' };
        const schema = JSON.parse(JSON.stringify(testData.schema));
        schema.properties.foo.format = 'email';
        component.uischema = uischema;
        component.schema = schema;
        getJsonFormsService(component).init({
            core: { data: testData.data, schema: schema, uischema: uischema },
        });
        component.ngOnInit();
        fixture.detectChanges();
        expect(textNativeElement.type).toBe('password');
    });
    it('should show email', () => {
        const schema = JSON.parse(JSON.stringify(testData.schema));
        schema.properties.foo.format = 'email';
        component.uischema = testData.uischema;
        component.schema = schema;
        getJsonFormsService(component).init({
            core: {
                data: testData.data,
                schema: schema,
                uischema: testData.uischema,
            },
        });
        component.ngOnInit();
        fixture.detectChanges();
        expect(textNativeElement.type).toBe('email');
    });
    xit('should show tel', () => {
        const schema = JSON.parse(JSON.stringify(testData.schema));
        schema.properties.foo.format = 'tel';
        component.uischema = testData.uischema;
        component.schema = schema;
        getJsonFormsService(component).init({
            core: {
                data: testData.data,
                schema: schema,
                uischema: testData.uischema,
            },
        });
        component.ngOnInit();
        fixture.detectChanges();
        expect(textNativeElement.type).toBe('tel');
    });
    xit('should fallback to text', () => {
        const schema = JSON.parse(JSON.stringify(testData.schema));
        schema.properties.foo.format = 'foo';
        component.uischema = testData.uischema;
        component.schema = schema;
        getJsonFormsService(component).init({
            core: {
                data: testData.data,
                schema: schema,
                uischema: testData.uischema,
            },
        });
        component.ngOnInit();
        fixture.detectChanges();
        expect(textNativeElement.type).toBe('text');
    });
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGV4dC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9saWJyYXJ5L3RleHQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBeUJBLE9BQU8sRUFBb0IsT0FBTyxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDbEUsT0FBTyxFQUFFLEVBQUUsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBRS9DLE9BQU8sRUFBRSxPQUFPLEVBQThCLE1BQU0saUJBQWlCLENBQUM7QUFDdEUsT0FBTyxFQUNMLFNBQVMsRUFFVCxtQkFBbUIsR0FHcEIsTUFBTSxRQUFRLENBQUM7QUFTaEIsTUFBTSxnQkFBZ0IsR0FBRyxDQUN2QixVQUF5QixFQUN6QixRQUFpQixFQUNqQixZQUE2QyxFQUN6QixFQUFFO0lBQ3RCLE1BQU0sT0FBTyxHQUFHLE9BQU8sQ0FBQyxlQUFlLENBQUMsVUFBVSxDQUFDLFdBQVcsQ0FBQyxDQUFDO0lBQ2hFLE1BQU0sU0FBUyxHQUFHLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQztJQUM1QyxNQUFNLE1BQU0sR0FBdUIsRUFBRSxPQUFPLEVBQUUsU0FBUyxFQUFFLENBQUM7SUFDMUQsSUFBSSxRQUFRLElBQUksWUFBWSxFQUFFO1FBQzVCLE1BQU0sV0FBVyxHQUFHLE9BQU8sQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztRQUNqRSxNQUFNLGlCQUFpQixHQUFHLFlBQVksQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUNwRCxNQUFNLENBQUMsV0FBVyxHQUFHLFdBQVcsQ0FBQztRQUNqQyxNQUFNLENBQUMsaUJBQWlCLEdBQUcsaUJBQWlCLENBQUM7S0FDOUM7SUFDRCxPQUFPLE1BQU0sQ0FBQztBQUNoQixDQUFDLENBQUM7QUFDRixNQUFNLFdBQVcsR0FBRyxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsQ0FBQztBQUNuQyxNQUFNLGFBQWEsR0FBZTtJQUNoQyxJQUFJLEVB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TyxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQ3hCLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDOUMsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICBUaGUgTUlUIExpY2Vuc2VcbiAgXG4gIENvcHlyaWdodCAoYykgMjAxNy0yMDE5IEVjbGlwc2VTb3VyY2UgTXVuaWNoXG4gIGh0dHBzOi8vZ2l0aHViLmNvbS9lY2xpcHNlc291cmNlL2pzb25mb3Jtc1xuICBcbiAgUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weVxuICBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0byBkZWFsXG4gIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHNcbiAgdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbFxuICBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXNcbiAgZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczpcbiAgXG4gIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluXG4gIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuICBcbiAgVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxuICBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcbiAgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFXG4gIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcbiAgTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSxcbiAgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTlxuICBUSEUgU09GVFdBUkUuXG4qL1xuaW1wb3J0IHR5cGUgeyBEZWJ1Z0VsZW1lbnQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IENvbXBvbmVudEZpeHR1cmUsIFRlc3RCZWQgfSBmcm9tICdAYW5ndWxhci9jb3JlL3Rlc3RpbmcnO1xuaW1wb3J0IHsgQnkgfSBmcm9tICdAYW5ndWxhci9wbGF0Zm9ybS1icm93c2VyJztcbmltcG9ydCB0eXBlIHsgSnNvbkZvcm1zQ29udHJvbCB9IGZyb20gJ0Bqc29uZm9ybXMvYW5ndWxhcic7XG5pbXBvcnQgeyBBY3Rpb25zLCBDb250cm9sRWxlbWVudCwgSnNvblNjaGVtYSB9IGZyb20gJ0Bqc29uZm9ybXMvY29yZSc7XG5pbXBvcnQge1xuICBiYXNlU2V0dXAsXG4gIEVycm9yVGVzdEV4cGVjdGF0aW9uLFxuICBnZXRKc29uRm9ybXNTZXJ2aWNlLFxuICBUZXN0Q29uZmlnLFxuICBUZXN0RGF0YSxcbn0gZnJvbSAnLi91dGlsJztcblxuaW50ZXJmYWNlIENvbXBvbmVudFJlc3VsdDxDIGV4dGVuZHMgSnNvbkZvcm1zQ29udHJvbD4ge1xuICBmaXh0dXJlOiBDb21wb25lbnRGaXh0dXJlPGFueT47XG4gIGNvbXBvbmVudDogQztcbiAgdGV4dEVsZW1lbnQ/OiBEZWJ1Z0VsZW1lbnQ7XG4gIHRleHROYXRpdmVFbGVtZW50PzogYW55O1xufVxuXG5jb25zdCBwcmVwYXJlQ29tcG9uZW50ID0gPEMgZXh0ZW5kcyBKc29uRm9ybXNDb250cm9sPihcbiAgdGVzdENvbmZpZzogVGVzdENvbmZpZzxDPixcbiAgaW5zdGFuY2U/OiBzdHJpbmcsXG4gIGVsZW1lbnRUb1VzZT86IChlbGVtZW50OiBEZWJ1Z0VsZW1lbnQpID0+IGFueVxuKTogQ29tcG9uZW50UmVzdWx0PEM+ID0+IHtcbiAgY29uc3QgZml4dHVyZSA9IFRlc3RCZWQuY3JlYXRlQ29tcG9uZW50KHRlc3RDb25maWcuY29tcG9uZW50VVQpO1xuICBjb25zdCBjb21wb25lbnQgPSBmaXh0dXJlLmNvbXBvbmVudEluc3RhbmNlO1xuICBjb25zdCByZXN1bHQ6IENvbXBvbmVudFJlc3VsdDxDPiA9IHsgZml4dHVyZSwgY29tcG9uZW50IH07XG4gIGlmIChpbnN0YW5jZSAmJiBlbGVtZW50VG9Vc2UpIHtcbiAgICBjb25zdCB0ZXh0RWxlbWVudCA9IGZpeHR1cmUuZGVidWdFbGVtZW50LnF1ZXJ5KEJ5LmNzcyhpbnN0YW5jZSkpO1xuICAgIGNvbnN0IHRleHROYXRpdmVFbGVtZW50ID0gZWxlbWVudFRvVXNlKHRleHRFbGVtZW50KTtcbiAgICByZXN1bHQudGV4dEVsZW1lbnQgPSB0ZXh0RWxlbWVudDtcbiAgICByZXN1bHQudGV4dE5hdGl2ZUVsZW1lbnQgPSB0ZXh0TmF0aXZlRWxlbWVudDtcbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufTtcbmNvbnN0IGRlZmF1bHREYXRhID0geyBmb286ICdmb28nIH07XG5jb25zdCBkZWZhdWx0U2NoZW1hOiBKc29uU2NoZW1hID0ge1xuICB0eXBlOiAnb2JqZWN0JyxcbiAgcHJvcGVydGllczoge1xuICAgIGZvbzoge1xuICAgICAgdHlwZTogJ3N0cmluZycsXG4gICAgfSxcbiAgfSxcbn07XG5jb25zdCBkZWZhdWx0VWlzY2hlbWE6IENvbnRyb2xFbGVtZW50ID0ge1xuICB0eXBlOiAnQ29udHJvbCcsXG4gIHNjb3BlOiAnIy9wcm9wZXJ0aWVzL2ZvbycsXG59O1xuZXhwb3J0IGNvbnN0IGRlZmF1bHRUZXh0VGVzdERhdGE6IFRlc3REYXRhPENvbnRyb2xFbGVtZW50PiA9IHtcbiAgZGF0YTogZGVmYXVsdERhdGEsXG4gIHNjaGVtYTogZGVmYXVsdFNjaGVtYSxcbiAgdWlzY2hlbWE6IGRlZmF1bHRVaXNjaGVtYSxcbn07XG5leHBvcnQgY29uc3QgdGV4dEJhc2VUZXN0ID1cbiAgPEMgZXh0ZW5kcyBKc29uRm9ybXNDb250cm9sPihcbiAgICB0ZXN0Q29uZmlnOiBUZXN0Q29uZmlnPEM+LFxuICAgIGluc3RhbmNlOiBzdHJpbmcsXG4gICAgZWxlbWVudFRvVXNlOiAoZWxlbWVudDogRGVidWdFbGVtZW50KSA9PiBhbnksXG4gICAgdGVzdERhdGE6IFRlc3REYXRhPENvbnRyb2xFbGVtZW50PiA9IGRlZmF1bHRUZXh0VGVzdERhdGFcbiAgKSA9PlxuICAoKSA9PiB7XG4gICAgbGV0IGZpeHR1cmU6IENvbXBvbmVudEZpeHR1cmU8YW55PjtcbiAgICBsZXQgdGV4dEVsZW1lbnQ6IERlYnVnRWxlbWVudDtcbiAgICBsZXQgdGV4dE5hdGl2ZUVsZW1lbnQ6IGFueTtcbiAgICBsZXQgY29tcG9uZW50OiBDO1xuXG4gICAgYmFzZVNldHVwKHRlc3RDb25maWcpO1xuXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICBjb25zdCBwcmVwYXJlZENvbXBvbmVudHMgPSBwcmVwYXJlQ29tcG9uZW50KFxuICAgICAgICB0ZXN0Q29uZmlnLFxuICAgICAgICBpbnN0YW5jZSxcbiAgICAgICAgZWxlbWVudFRvVXNlXG4gICAgICApO1xuICAgICAgZml4dHVyZSA9IHByZXBhcmVkQ29tcG9uZW50cy5maXh0dXJlO1xuICAgICAgdGV4dE5hdGl2ZUVsZW1lbnQgPSBwcmVwYXJlZENvbXBvbmVudHMudGV4dE5hdGl2ZUVsZW1lbnQ7XG4gICAgICB0ZXh0RWxlbWVudCA9IHByZXBhcmVkQ29tcG9uZW50cy50ZXh0RWxlbWVudDtcbiAgICAgIGNvbXBvbmVudCA9IHByZXBhcmVkQ29tcG9uZW50cy5jb21wb25lbnQ7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlbmRlcicsICgpID0+IHtcbiAgICAgIGNvbXBvbmVudC51aXNjaGVtYSA9IHRlc3REYXRhLnVpc2NoZW1hO1xuICAgICAgZ2V0SnNvbkZvcm1zU2VydmljZShjb21wb25lbnQpLmluaXQoe1xuICAgICAgICBjb3JlOiB7XG4gICAgICAgICAgZGF0YTogdGVzdERhdGEuZGF0YSxcbiAgICAgICAgICBzY2hlbWE6IHRlc3REYXRhLnNjaGVtYSxcbiAgICAgICAgICB1aXNjaGVtYTogdGVzdERhdGEudWlzY2hlbWEsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICAgIGNvbXBvbmVudC5uZ09uSW5pdCgpO1xuICAgICAgZml4dHVyZS5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgICBleHBlY3QoY29tcG9uZW50LmRhdGEpLnRvQmUoJ2ZvbycpO1xuICAgICAgZXhwZWN0KHRleHROYXRpdmVFbGVtZW50LnZhbHVlKS50b0JlKCdmb28nKTtcbiAgICAgIGV4cGVjdCh0ZXh0TmF0aXZlRWxlbWVudC5kaXNhYmxlZCkudG9CZShmYWxzZSk7XG4gICAgICAvLyB0aGUgY29tcG9uZW50IGlzIHdyYXBwZWQgaW4gYSBkaXZcbiAgICAgIGNvbnN0IGhhc0Rpc3BsYXlOb25lID1cbiAgICAgICAgJ25vbmUnID09PSBmaXh0dXJlLm5hdGl2ZUVsZW1lbnQuY2hpbGRyZW5bMF0uc3R5bGUuZGlzcGxheTtcbiAgICAgIGNvbnN0IGhhc0hpZGRlbiA9IGZpeHR1cmUubmF0aXZlRWxlbWVudC5jaGlsZHJlblswXS5oaWRkZW47XG4gICAgICBleHBlY3QoIWhhc0Rpc3BsYXlOb25lICYmICFoYXNIaWRkZW4pLnRvQmVUcnV0aHkoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgc3VwcG9ydCB1cGRhdGluZyB0aGUgc3RhdGUnLCAoKSA9PiB7XG4gICAgICBjb21wb25lbnQudWlzY2hlbWEgPSB0ZXN0RGF0YS51aXNjaGVtYTtcblxuICAgICAgZ2V0SnNvbkZvcm1zU2VydmljZShjb21wb25lbnQpLmluaXQoe1xuICAgICAgICBjb3JlOiB7XG4gICAgICAgICAgZGF0YTogdGVzdERhdGEuZGF0YSxcbiAgICAgICAgICBzY2hlbWE6IHRlc3REYXRhLnNjaGVtYSxcbiAgICAgICAgICB1aXNjaGVtYTogdGVzdERhdGEudWlzY2hlbWEsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICAgIGNvbXBvbmVudC5uZ09uSW5pdCgpO1xuICAgICAgZml4dHVyZS5kZXRlY3RDaGFuZ2VzKCk7XG5cbiAgICAgIGdldEpzb25Gb3Jtc1NlcnZpY2UoY29tcG9uZW50KS51cGRhdGVDb3JlKFxuICAgICAgICBBY3Rpb25zLnVwZGF0ZSgnZm9vJywgKCkgPT4gJ2JhcicpXG4gICAgICApO1xuICAgICAgZml4dHVyZS5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgICBleHBlY3QoY29tcG9uZW50LmRhdGEpLnRvQmUoJ2JhcicpO1xuICAgICAgZXhwZWN0KHRleHROYXRpdmVFbGVtZW50LnZhbHVlKS50b0JlKCdiYXInKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIHVwZGF0ZSB3aXRoIHVuZGVmaW5lZCB2YWx1ZScsICgpID0+IHtcbiAgICAgIGNvbXBvbmVudC51aXNjaGVtYSA9IHRlc3REYXRhLnVpc2NoZW1hO1xuXG4gICAgICBnZXRKc29uRm9ybXNTZXJ2aWNlKGNvbXBvbmVudCkuaW5pdCh7XG4gICAgICAgIGNvcmU6IHtcbiAgICAgICAgICBkYXRhOiB0ZXN0RGF0YS5kYXRhLFxuICAgICAgICAgIHNjaGVtYTogdGVzdERhdGEuc2NoZW1hLFxuICAgICAgICAgIHVpc2NoZW1hOiB0ZXN0RGF0YS51aXNjaGVtYSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgICAgY29tcG9uZW50Lm5nT25Jbml0KCk7XG4gICAgICBmaXh0dXJlLmRldGVjdENoYW5nZXMoKTtcblxuICAgICAgZ2V0SnNvbkZvcm1zU2VydmljZShjb21wb25lbnQpLnVwZGF0ZUNvcmUoXG4gICAgICAgIEFjdGlvbnMudXBkYXRlKCdmb28nLCAoKSA9PiB1bmRlZmluZWQpXG4gICAgICApO1xuICAgICAgZml4dHVyZS5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgICBleHBlY3QoY29tcG9uZW50LmRhdGEpLnRvQmUodW5kZWZpbmVkKTtcbiAgICAgIGV4cGVjdCh0ZXh0TmF0aXZlRWxlbWVudC52YWx1ZSkudG9CZSgnJyk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCB1cGRhdGUgd2l0aCBudWxsIHZhbHVlJywgKCkgPT4ge1xuICAgICAgY29tcG9uZW50LnVpc2NoZW1hID0gdGVzdERhdGEudWlzY2hlbWE7XG5cbiAgICAgIGdldEpzb25Gb3Jtc1NlcnZpY2UoY29tcG9uZW50KS5pbml0KHtcbiAgICAgICAgY29yZToge1xuICAgICAgICAgIGRhdGE6IHRlc3REYXRhLmRhdGEsXG4gICAgICAgICAgc2NoZW1hOiB0ZXN0RGF0YS5zY2hlbWEsXG4gICAgICAgICAgdWlzY2hlbWE6IHRlc3REYXRhLnVpc2NoZW1hLFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgICBjb21wb25lbnQubmdPbkluaXQoKTtcbiAgICAgIGZpeHR1cmUuZGV0ZWN0Q2hhbmdlcygpO1xuXG4gICAgICBnZXRKc29uRm9ybXNTZXJ2aWNlKGNvbXBvbmVudCkudXBkYXRlQ29yZShcbiAgICAgICAgQWN0aW9ucy51cGRhdGUoJ2ZvbycsICgpID0+IG51bGwpXG4gICAgICApO1xuICAgICAgZml4dHVyZS5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgICBleHBlY3QoY29tcG9uZW50LmRhdGEpLnRvQmUobnVsbCk7XG4gICAgICBleHBlY3QodGV4dE5hdGl2ZUVsZW1lbnQudmFsdWUpLnRvQmUoJycpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgbm90IHVwZGF0ZSB3aXRoIHdyb25nIHJlZicsICgpID0+IHtcbiAgICAgIGNvbXBvbmVudC51aXNjaGVtYSA9IHRlc3REYXRhLnVpc2NoZW1hO1xuXG4gICAgICBnZXRKc29uRm9ybXNTZXJ2aWNlKGNvbXBvbmVudCkuaW5pdCh7XG4gICAgICAgIGNvcmU6IHtcbiAgICAgICAgICBkYXRhOiB0ZXN0RGF0YS5kYXRhLFxuICAgICAgICAgIHNjaGVtYTogdGVzdERhdGEuc2NoZW1hLFxuICAgICAgICAgIHVpc2NoZW1hOiB0ZXN0RGF0YS51aXNjaGVtYSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgICAgY29tcG9uZW50Lm5nT25Jbml0KCk7XG4gICAgICBmaXh0dXJlLmRldGVjdENoYW5nZXMoKTtcblxuICAgICAgZ2V0SnNvbkZvcm1zU2VydmljZShjb21wb25lbnQpLnVwZGF0ZUNvcmUoXG4gICAgICAgIEFjdGlvbnMudXBkYXRlKCdmb28nLCAoKSA9PiAnZm9vJylcbiAgICAgICk7XG4gICAgICBnZXRKc29uRm9ybXNTZXJ2aWNlKGNvbXBvbmVudCkudXBkYXRlQ29yZShcbiAgICAgICAgQWN0aW9ucy51cGRhdGUoJ2JhcicsICgpID0+ICdiYXInKVxuICAgICAgKTtcbiAgICAgIGZpeHR1cmUuZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgZXhwZWN0KGNvbXBvbmVudC5kYXRhKS50b0JlKCdmb28nKTtcbiAgICAgIGV4cGVjdCh0ZXh0TmF0aXZlRWxlbWVudC52YWx1ZSkudG9CZSgnZm9vJyk7XG4gICAgfSk7XG4gICAgLy8gc3RvcmUgbmVlZGVkIGFzIHdlIGV2YWx1YXRlIHRoZSBjYWxjdWxhdGVkIGVuYWJsZWQgdmFsdWUgdG8gZGlzYWJsZS9lbmFibGUgdGhlIGNvbnRyb2xcbiAgICBpdCgnY2FuIGJlIGRpc2FibGVkJywgKCkgPT4ge1xuICAgICAgY29tcG9uZW50LnVpc2NoZW1hID0gdGVzdERhdGEudWlzY2hlbWE7XG4gICAgICBjb21wb25lbnQuZGlzYWJsZWQgPSB0cnVlO1xuXG4gICAgICBnZXRKc29uRm9ybXNTZXJ2aWNlKGNvbXBvbmVudCkuaW5pdCh7XG4gICAgICAgIGNvcmU6IHtcbiAgICAgICAgICBkYXRhOiB0ZXN0RGF0YS5kYXRhLFxuICAgICAgICAgIHNjaGVtYTogdGVzdERhdGEuc2NoZW1hLFxuICAgICAgICAgIHVpc2NoZW1hOiB0ZXN0RGF0YS51aXNjaGVtYSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgICAgY29tcG9uZW50Lm5nT25Jbml0KCk7XG4gICAgICBmaXh0dXJlLmRldGVjdENoYW5nZXMoKTtcbiAgICAgIGV4cGVjdCh0ZXh0TmF0aXZlRWxlbWVudC5kaXNhYmxlZCkudG9CZSh0cnVlKTtcbiAgICB9KTtcbiAgICBpdCgnY2FuIGJlIGhpZGRlbicsICgpID0+IHtcbiAgICAgIGNvbXBvbmVudC51aXNjaGVtYSA9IHRlc3REYXRhLnVpc2NoZW1hO1xuICAgICAgY29tcG9uZW50LnZpc2libGUgPSBmYWxzZTtcblxuICAgICAgZ2V0SnNvbkZvcm1zU2VydmljZShjb21wb25lbnQpLmluaXQoe1xuICAgICAgICBjb3JlOiB7XG4gICAgICAgICAgZGF0YTogdGVzdERhdGEuZGF0YSxcbiAgICAgICAgICBzY2hlbWE6IHRlc3REYXRhLnNjaGVtYSxcbiAgICAgICAgICB1aXNjaGVtYTogdGVzdERhdGEudWlzY2hlbWEsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICAgIGNvbXBvbmVudC5uZ09uSW5pdCgpO1xuICAgICAgZml4dHVyZS5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgICBjb25zdCBoYXNEaXNwbGF5Tm9uZSA9XG4gICAgICAgICdub25lJyA9PT0gZml4dHVyZS5uYXRpdmVFbGVtZW50LmNoaWxkcmVuWzBdLnN0eWxlLmRpc3BsYXk7XG4gICAgICBjb25zdCBoYXNIaWRkZW4gPSBmaXh0dXJlLm5hdGl2ZUVsZW1lbnQuY2hpbGRyZW5bMF0uaGlkZGVuO1xuICAgICAgZXhwZWN0KGhhc0Rpc3BsYXlOb25lIHx8IGhhc0hpZGRlbikudG9CZVRydXRoeSgpO1xuICAgIH0pO1xuICAgIGl0KCdpZCBzaG91bGQgYmUgcHJlc2VudCBpbiBvdXRwdXQnLCAoKSA9PiB7XG4gICAgICBjb21wb25lbnQudWlzY2hlbWEgPSB0ZXN0RGF0YS51aXNjaGVtYTtcbiAgICAgIGNvbXBvbmVudC5pZCA9ICdteUlkJztcbiAgICAgIGdldEpzb25Gb3Jtc1NlcnZpY2UoY29tcG9uZW50KS5pbml0KHtcbiAgICAgICAgY29yZToge1xuICAgICAgICAgIGRhdGE6IHRlc3REYXRhLmRhdGEsXG4gICAgICAgICAgc2NoZW1hOiB0ZXN0RGF0YS5zY2hlbWEsXG4gICAgICAgICAgdWlzY2hlbWE6IHRlc3REYXRhLnVpc2NoZW1hLFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgICBjb21wb25lbnQubmdPbkluaXQoKTtcbiAgICAgIGZpeHR1cmUuZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgZXhwZWN0KHRleHRFbGVtZW50Lm5hdGl2ZUVsZW1lbnQuaWQpLnRvQmUoJ215SWQnKTtcbiAgICB9KTtcbiAgfTtcbmV4cG9ydCBjb25zdCB0ZXh0SW5wdXRFdmVudFRlc3QgPVxuICA8QyBleHRlbmRzIEpzb25Gb3Jtc0NvbnRyb2w+KFxuICAgIHRlc3RDb25maWc6IFRlc3RDb25maWc8Qz4sXG4gICAgaW5zdGFuY2U6IHN0cmluZyxcbiAgICBlbGVtZW50VG9Vc2U6IChlbGVtZW50OiBEZWJ1Z0VsZW1lbnQpID0+IGFueSxcbiAgICB0ZXN0RGF0YTogVGVzdERhdGE8Q29udHJvbEVsZW1lbnQ+ID0gZGVmYXVsdFRleHRUZXN0RGF0YVxuICApID0+XG4gICgpID0+IHtcbiAgICBsZXQgZml4dHVyZTogQ29tcG9uZW50Rml4dHVyZTxhbnk+O1xuICAgIGxldCB0ZXh0TmF0aXZlRWxlbWVudDogYW55O1xuICAgIGxldCBjb21wb25lbnQ6IEM7XG5cbiAgICBiYXNlU2V0dXAodGVzdENvbmZpZyk7XG5cbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIGNvbnN0IHByZXBhcmVkQ29tcG9uZW50cyA9IHByZXBhcmVDb21wb25lbnQoXG4gICAgICAgIHRlc3RDb25maWcsXG4gICAgICAgIGluc3RhbmNlLFxuICAgICAgICBlbGVtZW50VG9Vc2VcbiAgICAgICk7XG4gICAgICBmaXh0dXJlID0gcHJlcGFyZWRDb21wb25lbnRzLmZpeHR1cmU7XG4gICAgICB0ZXh0TmF0aXZlRWxlbWVudCA9IHByZXBhcmVkQ29tcG9uZW50cy50ZXh0TmF0aXZlRWxlbWVudDtcbiAgICAgIGNvbXBvbmVudCA9IHByZXBhcmVkQ29tcG9uZW50cy5jb21wb25lbnQ7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHVwZGF0ZSB2aWEgaW5wdXQgZXZlbnQnLCAoKSA9PiB7XG4gICAgICBjb21wb25lbnQudWlzY2hlbWEgPSB0ZXN0RGF0YS51aXNjaGVtYTtcblxuICAgICAgZ2V0SnNvbkZvcm1zU2VydmljZShjb21wb25lbnQpLmluaXQoe1xuICAgICAgICBjb3JlOiB7XG4gICAgICAgICAgZGF0YTogdGVzdERhdGEuZGF0YSxcbiAgICAgICAgICBzY2hlbWE6IHRlc3REYXRhLnNjaGVtYSxcbiAgICAgICAgICB1aXNjaGVtYTogdGVzdERhdGEudWlzY2hlbWEsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICAgIGNvbXBvbmVudC5uZ09uSW5pdCgpO1xuICAgICAgZml4dHVyZS5kZXRlY3RDaGFuZ2VzKCk7XG5cbiAgICAgIGNvbnN0IHNweSA9IHNweU9uKGNvbXBvbmVudCwgJ29uQ2hhbmdlJyk7XG4gICAgICB0ZXh0TmF0aXZlRWxlbWVudC52YWx1ZSA9ICdiYXInO1xuICAgICAgaWYgKHRleHROYXRpdmVFbGVtZW50LmRpc3BhdGNoRXZlbnQpIHtcbiAgICAgICAgdGV4dE5hdGl2ZUVsZW1lbnQuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoJ2lucHV0JykpO1xuICAgICAgfVxuICAgICAgLy8gdHJpZ2dlciBjaGFuZ2UgZGV0ZWN0aW9uXG4gICAgICBmaXh0dXJlLmRldGVjdENoYW5nZXMoKTtcbiAgICAgIGV4cGVjdChzcHkpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIGV4cGVjdCh0ZXh0TmF0aXZlRWxlbWVudC52YWx1ZSkudG9CZSgnYmFyJyk7XG4gICAgfSk7XG4gIH07XG5leHBvcnQgY29uc3QgdGV4dEVycm9yVGVzdCA9XG4gIDxDIGV4dGVuZHMgSnNvbkZvcm1zQ29udHJvbD4oXG4gICAgdGVzdENvbmZpZzogVGVzdENvbmZpZzxDPixcbiAgICBlcnJvclRlc3RJbmZvcm1hdGlvbjogRXJyb3JUZXN0RXhwZWN0YXRpb24sXG4gICAgdGVzdERhdGE6IFRlc3REYXRhPENvbnRyb2xFbGVtZW50PiA9IGRlZmF1bHRUZXh0VGVzdERhdGFcbiAgKSA9PlxuICAoKSA9PiB7XG4gICAgbGV0IGZpeHR1cmU6IENvbXBvbmVudEZpeHR1cmU8YW55PjtcbiAgICBsZXQgY29tcG9uZW50OiBDO1xuXG4gICAgYmFzZVNldHVwKHRlc3RDb25maWcpO1xuXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICBjb25zdCBwcmVwYXJlZENvbXBvbmVudHMgPSBwcmVwYXJlQ29tcG9uZW50KHRlc3RDb25maWcpO1xuICAgICAgZml4dHVyZSA9IHByZXBhcmVkQ29tcG9uZW50cy5maXh0dXJlO1xuICAgICAgY29tcG9uZW50ID0gcHJlcGFyZWRDb21wb25lbnRzLmNvbXBvbmVudDtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIGRpc3BsYXkgZXJyb3JzJywgKCkgPT4ge1xuICAgICAgY29tcG9uZW50LnVpc2NoZW1hID0gdGVzdERhdGEudWlzY2hlbWE7XG5cbiAgICAgIGNvbnN0IGZvcm1zU2VydmljZSA9IGdldEpzb25Gb3Jtc1NlcnZpY2UoY29tcG9uZW50KTtcbiAgICAgIGZvcm1zU2VydmljZS5pbml0KHtcbiAgICAgICAgY29yZToge1xuICAgICAgICAgIGRhdGE6IHRlc3REYXRhLmRhdGEsXG4gICAgICAgICAgc2NoZW1hOiB0ZXN0RGF0YS5zY2hlbWEsXG4gICAgICAgICAgdWlzY2hlbWE6IHVuZGVmaW5lZCxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgICAgZm9ybXNTZXJ2aWNlLnVwZGF0ZUNvcmUoXG4gICAgICAgIEFjdGlvbnMudXBkYXRlRXJyb3JzKFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBpbnN0YW5jZVBhdGg6ICcvZm9vJyxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdIaSwgdGhpcyBpcyBtZSwgdGVzdCBlcnJvciEnLFxuICAgICAgICAgICAga2V5d29yZDogJycsXG4gICAgICAgICAgICBzY2hlbWFQYXRoOiAnJyxcbiAgICAgICAgICAgIHBhcmFtczoge30sXG4gICAgICAgICAgfSxcbiAgICAgICAgXSlcbiAgICAgICk7XG4gICAgICBmb3Jtc1NlcnZpY2UucmVmcmVzaCgpO1xuICAgICAgY29tcG9uZW50Lm5nT25Jbml0KCk7XG4gICAgICBmaXh0dXJlLmRldGVjdENoYW5nZXMoKTtcbiAgICAgIGNvbnN0IGRlYnVnRXJyb3JzOiBEZWJ1Z0VsZW1lbnRbXSA9IGZpeHR1cmUuZGVidWdFbGVtZW50LnF1ZXJ5QWxsKFxuICAgICAgICBCeS5kaXJlY3RpdmUoZXJyb3JUZXN0SW5mb3JtYXRpb24uZXJyb3JJbnN0YW5jZSlcbiAgICAgICk7XG4gICAgICBleHBlY3QoZGVidWdFcnJvcnMubGVuZ3RoKS50b0JlKGVycm9yVGVzdEluZm9ybWF0aW9uLm51bWJlck9mRWxlbWVudHMpO1xuICAgICAgZXhwZWN0KFxuICAgICAgICBkZWJ1Z0Vycm9yc1tlcnJvclRlc3RJbmZvcm1hdGlvbi5pbmRleE9mRWxlbWVudF0ubmF0aXZlRWxlbWVudFxuICAgICAgICAgIC50ZXh0Q29udGVudFxuICAgICAgKS50b0JlKCdIaSwgdGhpcyBpcyBtZSwgdGVzdCBlcnJvciEnKTtcbiAgICB9KTtcbiAgfTtcbmV4cG9ydCBjb25zdCB0ZXh0VHlwZVRlc3QgPVxuICA8QyBleHRlbmRzIEpzb25Gb3Jtc0NvbnRyb2w+KFxuICAgIHRlc3RDb25maWc6IFRlc3RDb25maWc8Qz4sXG4gICAgaW5zdGFuY2U6IHN0cmluZyxcbiAgICBlbGVtZW50VG9Vc2U6IChlbGVtZW50OiBEZWJ1Z0VsZW1lbnQpID0+IGFueSxcbiAgICB0ZXN0RGF0YTogVGVzdERhdGE8Q29udHJvbEVsZW1lbnQ+ID0gZGVmYXVsdFRleHRUZXN0RGF0YVxuICApID0+XG4gICgpID0+IHtcbiAgICBsZXQgZml4dHVyZTogQ29tcG9uZW50Rml4dHVyZTxhbnk+O1xuICAgIGxldCBjb21wb25lbnQ6IEM7XG4gICAgbGV0IHRleHROYXRpdmVFbGVtZW50OiBhbnk7XG5cbiAgICBiYXNlU2V0dXAodGVzdENvbmZpZyk7XG5cbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIGNvbnN0IHByZXBhcmVkQ29tcG9uZW50cyA9IHByZXBhcmVDb21wb25lbnQoXG4gICAgICAgIHRlc3RDb25maWcsXG4gICAgICAgIGluc3RhbmNlLFxuICAgICAgICBlbGVtZW50VG9Vc2VcbiAgICAgICk7XG4gICAgICBmaXh0dXJlID0gcHJlcGFyZWRDb21wb25lbnRzLmZpeHR1cmU7XG4gICAgICBjb21wb25lbnQgPSBwcmVwYXJlZENvbXBvbmVudHMuY29tcG9uZW50O1xuICAgICAgdGV4dE5hdGl2ZUVsZW1lbnQgPSBwcmVwYXJlZENvbXBvbmVudHMudGV4dE5hdGl2ZUVsZW1lbnQ7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBzaG93IHBhc3N3b3JkIGluZGVwZW5kZW50IG9mIHNjaGVtYScsICgpID0+IHtcbiAgICAgIGNvbnN0IHVpc2NoZW1hID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0ZXN0RGF0YS51aXNjaGVtYSkpO1xuICAgICAgdWlzY2hlbWEub3B0aW9ucyA9IHsgZm9ybWF0OiAncGFzc3dvcmQnIH07XG4gICAgICBjb25zdCBzY2hlbWEgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRlc3REYXRhLnNjaGVtYSkpO1xuICAgICAgc2NoZW1hLnByb3BlcnRpZXMuZm9vLmZvcm1hdCA9ICdlbWFpbCc7XG5cbiAgICAgIGNvbXBvbmVudC51aXNjaGVtYSA9IHVpc2NoZW1hO1xuICAgICAgY29tcG9uZW50LnNjaGVtYSA9IHNjaGVtYTtcblxuICAgICAgZ2V0SnNvbkZvcm1zU2VydmljZShjb21wb25lbnQpLmluaXQoe1xuICAgICAgICBjb3JlOiB7IGRhdGE6IHRlc3REYXRhLmRhdGEsIHNjaGVtYTogc2NoZW1hLCB1aXNjaGVtYTogdWlzY2hlbWEgfSxcbiAgICAgIH0pO1xuICAgICAgY29tcG9uZW50Lm5nT25Jbml0KCk7XG4gICAgICBmaXh0dXJlLmRldGVjdENoYW5nZXMoKTtcbiAgICAgIGV4cGVjdCh0ZXh0TmF0aXZlRWxlbWVudC50eXBlKS50b0JlKCdwYXNzd29yZCcpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgc2hvdyBlbWFpbCcsICgpID0+IHtcbiAgICAgIGNvbnN0IHNjaGVtYSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGVzdERhdGEuc2NoZW1hKSk7XG4gICAgICBzY2hlbWEucHJvcGVydGllcy5mb28uZm9ybWF0ID0gJ2VtYWlsJztcblxuICAgICAgY29tcG9uZW50LnVpc2NoZW1hID0gdGVzdERhdGEudWlzY2hlbWE7XG4gICAgICBjb21wb25lbnQuc2NoZW1hID0gc2NoZW1hO1xuXG4gICAgICBnZXRKc29uRm9ybXNTZXJ2aWNlKGNvbXBvbmVudCkuaW5pdCh7XG4gICAgICAgIGNvcmU6IHtcbiAgICAgICAgICBkYXRhOiB0ZXN0RGF0YS5kYXRhLFxuICAgICAgICAgIHNjaGVtYTogc2NoZW1hLFxuICAgICAgICAgIHVpc2NoZW1hOiB0ZXN0RGF0YS51aXNjaGVtYSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgICAgY29tcG9uZW50Lm5nT25Jbml0KCk7XG4gICAgICBmaXh0dXJlLmRldGVjdENoYW5nZXMoKTtcbiAgICAgIGV4cGVjdCh0ZXh0TmF0aXZlRWxlbWVudC50eXBlKS50b0JlKCdlbWFpbCcpO1xuICAgIH0pO1xuICAgIHhpdCgnc2hvdWxkIHNob3cgdGVsJywgKCkgPT4ge1xuICAgICAgY29uc3Qgc2NoZW1hID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0ZXN0RGF0YS5zY2hlbWEpKTtcbiAgICAgIHNjaGVtYS5wcm9wZXJ0aWVzLmZvby5mb3JtYXQgPSAndGVsJztcblxuICAgICAgY29tcG9uZW50LnVpc2NoZW1hID0gdGVzdERhdGEudWlzY2hlbWE7XG4gICAgICBjb21wb25lbnQuc2NoZW1hID0gc2NoZW1hO1xuXG4gICAgICBnZXRKc29uRm9ybXNTZXJ2aWNlKGNvbXBvbmVudCkuaW5pdCh7XG4gICAgICAgIGNvcmU6IHtcbiAgICAgICAgICBkYXRhOiB0ZXN0RGF0YS5kYXRhLFxuICAgICAgICAgIHNjaGVtYTogc2NoZW1hLFxuICAgICAgICAgIHVpc2NoZW1hOiB0ZXN0RGF0YS51aXNjaGVtYSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgICAgY29tcG9uZW50Lm5nT25Jbml0KCk7XG4gICAgICBmaXh0dXJlLmRldGVjdENoYW5nZXMoKTtcbiAgICAgIGV4cGVjdCh0ZXh0TmF0aXZlRWxlbWVudC50eXBlKS50b0JlKCd0ZWwnKTtcbiAgICB9KTtcbiAgICB4aXQoJ3Nob3VsZCBmYWxsYmFjayB0byB0ZXh0JywgKCkgPT4ge1xuICAgICAgY29uc3Qgc2NoZW1hID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0ZXN0RGF0YS5zY2hlbWEpKTtcbiAgICAgIHNjaGVtYS5wcm9wZXJ0aWVzLmZvby5mb3JtYXQgPSAnZm9vJztcblxuICAgICAgY29tcG9uZW50LnVpc2NoZW1hID0gdGVzdERhdGEudWlzY2hlbWE7XG4gICAgICBjb21wb25lbnQuc2NoZW1hID0gc2NoZW1hO1xuXG4gICAgICBnZXRKc29uRm9ybXNTZXJ2aWNlKGNvbXBvbmVudCkuaW5pdCh7XG4gICAgICAgIGNvcmU6IHtcbiAgICAgICAgICBkYXRhOiB0ZXN0RGF0YS5kYXRhLFxuICAgICAgICAgIHNjaGVtYTogc2NoZW1hLFxuICAgICAgICAgIHVpc2NoZW1hOiB0ZXN0RGF0YS51aXNjaGVtYSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgICAgY29tcG9uZW50Lm5nT25Jbml0KCk7XG4gICAgICBmaXh0dXJlLmRldGVjdENoYW5nZXMoKTtcbiAgICAgIGV4cGVjdCh0ZXh0TmF0aXZlRWxlbWVudC50eXBlKS50b0JlKCd0ZXh0Jyk7XG4gICAgfSk7XG4gIH07XG4iXX0=